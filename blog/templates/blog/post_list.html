{% load static %}
<html >
    <head style="">
        <title>sinaps.workspace</title>
        <link rel="shortcut icon" href="{% static '/image/favicon.ico' %}" type="image/x-icon">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker.min.css" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css?family=Lobster&subset=latin,cyrillic" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="{% static 'css/styles.css' %}">
        <link rel="stylesheet" href="{% static 'css/jquery.treegrid.css' %}">
        <link rel="stylesheet" href="{% static 'css/blog.css' %}">
        <link rel="stylesheet" href="{% static 'css/animate.min.css' %}" />
    </head>
    <body style="">

        <div id="html_cont" class="background-container" style="filter: blur(10px);">
            <div id="picoutput"></div>
            <div class="page-header">
                <div class="row" style="max-height: 60px; margin-left: 0px; margin-right: 0px">
                    <div class="col-sm-1" style="max-height: 60px ;vertical-align: center; margin-left: -15px">
                        <img src="{% static '/image/sinaps_.png' %}" alt="" class="wow animate__animated animate__rotateIn" style="visibility: visible; animation-duration: 5s;height: 45px; margin-top: 7px">
                    </div>
                    <div class="col-sm-8" style="max-height: 60px; margin-left: -98px">
                        <a class="head_title" style=" cursor: pointer; margin-left: 10px; margin-top: 5px;" onclick="backMain()">
                            <div class="row" style="cursor: pointer;width: 800px" onclick="backMain()">
                                <div class="column" style="margin-left: 16px">
                                   <h1 style="max-height: 40px; margin-top: 10px">
                                        <a style="margin-left: -25px; font-family: Aeroport;height: 20px; max-height: 20px; font-size: 30px;">
                                            С-ПЛАСТ
                                        </a>
                                    </h1>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <div class="container-fluid" style="padding-top: 20px; padding-left: 30px">
                <button disabled="true" id="release" name="but1" value="val_1" type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#exampleModalCenter" onclick="">
                    Выпустить
                </button>
                <button disabled="true" id="transfer" name="but1" value="val_2" type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#exampleModalCenter_transfer" onclick="">
                    Передать
                </button>
                <button disabled="true" id="report" name="but1" value="val_3" type="button" class="btn btn-warning btn-sm" data-toggle="modal" data-target="#exampleModalCenter_m29" onclick="modal_m29_init()">
                    Отчет М29
                </button>
                <button disabled="true" id="statistic" name="but1" value="val_4" type="button" class="btn btn-warning btn-sm">
                    <a href="{% url 'statistic' %}" style="text-decoration: none; color: black" onclick="goStatistic()">Статистика</a>
                </button>
                <button disabled="true" id="structure" name="but1" value="val_5" type="button" class="btn btn-secondary btn-sm" >
                    <a href="{% url 'structure' %}" style="text-decoration: none; color: white" onclick="goStructure()">Управление заявками</a>
                </button>
                <button disabled="true" id="journal" name="but1" value="val_6" type="button" class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#exampleModalCenter_transfer" onclick="">
                    Журнал событий
                </button>
                <div style="margin-top: 9px; margin-left: -6px">
                    <div id="well_table" class="container-fluid row" style="">
                        <div class="scroll" style="overflow-y: scroll; width: 1890px; height: 784px">
                            <table class=" table table-bordered"  style="margin-bottom: 0px;">
                                <thead style="">
                                    <tr>
                                    <th scope="col" style="text-align: center; background-color: #577fae; padding: 0.1rem; padding-bottom: 7px;">
                                      <a style="font-weight: normal; color: white">
                                        Сост. на начало
                                      </a>
                                    </th>
                                    <th scope="col" style="text-align: center; background-color: #577fae; padding: 0.1rem; padding-bottom: 7px;">
                                          <a style="font-weight: normal; color: white">
                                            Тип
                                          </a>
                                      </th>
                                    <th scope="col" style="text-align: center; background-color: #577fae; padding: 0.1rem; padding-bottom: 7px;">
                                          <a style="font-weight: normal; color: white">
                                            Дата выпуска
                                          </a>
                                      </th>
                                    <th scope="col" style="text-align: center; background-color: #577fae; padding: 0.1rem; padding-bottom: 7px;">
                                          <a style="font-weight: normal; color: white">
                                            Нахождение
                                          </a>
                                      </th>
                                    <th scope="col" style="text-align: center; background-color: #577fae; padding: 0.1rem; padding-bottom: 7px;">
                                          <a style="font-weight: normal; color: white">
                                            Комментарий
                                          </a>
                                      </th>
                                    </tr>
                                </thead>
                                <tbody style="">
                                    {% for well in wells %}
                                        <tr>
                                          <td scope="row"  >С-пласт {{ well.serial }}</td>
                                          <td>{{ well.type }}</td>
                                          <td>{{ well.created_date }}</td>
                                          <td>{{ well.locate }}</td>
                                          <td>{{ well.comment }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {#========================LOGIN==========================#}
        <form method="GET">
            <div class="modal fade" id="modalLogin" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Авторизация</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" hidden>
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" style="">
                    <div class="content-box" style="text-align:right; background-color: #ffffff; height: 90px">
                        <div class="row">
                            <div class="col-sm-5" style="margin-left: -20px;">
                            <td>Логин :</td>
                              <br>
                              <br>
                            <td>Пароль :</td>
                            </div>
                            <div  class="col-sm-5" style="text-align: left; padding-left: 10px; padding-top: 2px">
                                <div class="row">
                                    <input id="modalLogin_login" style="height: 23px; border: none; border-bottom: 1px solid #bbbbbb; outline: none;">
                                </div>
                                <div class="row">
                                    <a id="modalLogin_login_error" style=";text-align: left; font-size: 13px; color: red; position: fixed" hidden>неверный логин</a>
                                </div>
                                <div class="row" style="padding-top: 26px">
                                    <input id="modalLogin_password" type="password" style="height: 23px; margin-right: 0px; border: none; border-bottom: 1px solid #bbbbbb; outline: none;">
                                </div>
                                <div class="row">
                                    <a id="modalLogin_password_error" style="text-align: left; font-size: 13px; color: red;" hidden>неверный пароль</a>
                                </div>
                            </div>
                        </div>
                      </div>
                  </div>
                  <div class="modal-footer">
                    <button id="modal_login_cancel" type="button" class="btn btn-secondary" data-dismiss="modal" hidden>Отмена</button>
                    <button id="modal_login_save" type="button" class="btn btn-primary" onclick="check_login()">Войти</button>
                  </div>
                </div>
              </div>
            </div>
        </form>
        {#=======================================================#}
        {#====================MODAL RELEASE======================#}
        <form method="GET">

            <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Выпуск колодца</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div class="content-box" style="text-align:right; background-color: #ffffff;">
                        <div class="row">
                            <div class="col-sm-5" style="padding-left: 10px;">
                            <td>Дата производства:</td>
                              <br>
                              <br>
                            <td>Колодец:</td>
                              <br>
                              <br>
                            <td>Серийный номер:</td>
                              <br>
                              <br>
                            <td>Приход:</td>
                              <br>
                            </div>
                            <div  class="col-sm-4" style="text-align: left">
                                <input data-date-format="dd/mm/yyyy" id="release_date" style="height: 23px;">
                                <br>
                                <br>
                                <select id="release_type" class="form-select" aria-label="Default select example">
                                  <option selected>{{ type_first_elem }}</option>
                                    {% for type in types %}
                                        <tr>
                                        {% if type.pk > 1 %}
                                            <tr>
                                            <option value="{{ type.type_name }}">{{ type.type_name }}</option>
                                            </tr>
                                        {% endif %}
                                        </tr>
                                    {% endfor %}
                                </select>
                                <br>
                                <br>
                                <h2 id="release_serial" name="serial" style="margin-top: -6px; font-weight: inherit;"></h2>
                                <br>
                                <br>
                                <select id="release_wh" class="form-select" aria-label="Default select example" style="margin-top: -49px; ">
                                  <option selected>{{ wh_first_elem }}</option>
                                    {% for wh in wh_lst %}
                                        <tr>
                                        {% if wh_lst.pk > 1 %}
                                            <tr>
                                            <option value="{{ wh.pk }}">{{ wh.type_name }}</option>
                                            </tr>
                                        {% endif %}
                                        </tr>
                                    {% endfor %}
                                </select>
                                <br>
                            </div>
                        </div>
                      </div>
                  </div>
                  <div class="modal-footer">
                    <button id="modal_cancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                    <button id="modal_save" type="button" class="btn btn-primary" onclick="">Выпустить</button>
                  </div>
                </div>
              </div>
            </div>
            <input id="access_token" type="hidden" name="access_token" value="<?php echo $_SESSION['access_token']; ?>" />
        </form>
        {#=======================================================#}
        {#====================MODAL TRANSFER=====================#}
        <form method="GET">
            <div class="modal fade" id="exampleModalCenter_transfer" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content" style="min-width: 1105px; margin-left: -560px">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Перемещение</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                      <div id="connect_well_full" hidden></div>
                      <div id="connect_well_arr" hidden></div>
                      <div id="connect_well_type" hidden></div>
                      <div id="parent_count" hidden>0</div>
                      <div id="serial_lst" hidden></div>
                  </div>
                  <div class="modal-body">
                    <div class="content-box" style="text-align:right; background-color: #ffffff;">
                        <div class="row">
                            <div class="content-box" style="text-align: left; margin-left: 15px; width: 440px;">
                                <div class="row" style="min-width: 1100px">
                                    <div class="col" style="min-width: 500px">
                                        <button id="button_add" style="margin-left: 0px;" name="but1"  value="val_1" type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#modal_well_lst" onclick="initWellTbl({{ type_first_elem }})">
                                            Добавить
                                        </button>
                                        <div class="content-box" style="border: 1px solid #d2d2d2; width: 470px; margin-top: 10px;">
                                            <div class="row" style="border-bottom: 1px solid #d2d2d2; margin-left: 0px; width: 468px; background-color: #577fae; color: white">
                                                <th scope="col" ><span style="margin-left: 32px">Тип колодца</span></th>
                                                <th scope="col"><span style="margin-left: 235px">Количество</span></th>
                                            </div>
                                            <div class="row" id="" >
                                                <div class="scroll" style="height: 300px; overflow-y: scroll">
                                                <table id="transfer_well_lst" class="tree" style="margin-left: 20px; width: 450px;">
                                                </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row" style="margin-left: 0px; margin-top: 5px">
                                            <div clacc="column">
                                                <td>Всего к передаче:</td>
                                                    <br>
                                                    <br>
                                                <td>Дата передачи:</td>
                                                    <br>
                                                    <br>
                                                <td>Действие:</td>
                                                    <br>
                                                    <br>
                                                <td><span id="transfer_field_text">Шифр:</span></td>
                                                    <br>
                                                    <br>
                                                <td>Заявка:</td>
                                            </div>
                                            <div class="column" style="margin-left: 5px;">

                                                <td><span id="transfer_well_counter">0</span></td>
                                                    <br>
                                                    <br>
                                                <td><input data-date-format="dd/mm/yyyy" id="transaction_date" style="height: 23px; width: 105px"></td>
                                                    <br>
                                                    <br>
                                                <td>
                                                    <select id="transaction_action_type" class="form-select" aria-label="Default select example">
                                                      <option value="transfer" selected>Перемещение</option>
                                                        <tr>
                                                            <option value="selling">Продажа</option>
                                                        </tr>
                                                    </select>
                                                </td>
                                                    <br>
                                                    <br>
                                                <td>
                                                    <select id="transfer_code_num" class="form-select" aria-label="Default select example" style="width: 130px">
                                                      <option selected>{{ code_first_elem }}</option>
                                                        {% for code in code_lst %}
                                                            <tr>
                                                            {% if code.code_name != code_first_elem %}
                                                                <tr>
                                                                <option value="{{ code.code_name }}">{{ code.code_name }}</option>
                                                                </tr>
                                                            {% endif %}
                                                            </tr>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                    <br>
                                                    <br>
                                                <td>
                                                    <select id="transfer_mpz_num" class="form-select" aria-label="Default select example" style="width: 130px;">
                                                      <option selected>{{ first_code_mpz_lst_first_elem }}</option>
                                                        {% for mpz in first_code_mpz_lst %}
                                                            <tr>
                                                            {% if mpz != first_code_mpz_lst_first_elem %}
                                                                <tr>
                                                                <option value="{{ mpz }}">{{ mpz }}</option>
                                                                </tr>
                                                            {% endif %}
                                                            </tr>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col" style="margin-left: -30px">
                                        <span id="trans_modal_mpz_num" style="font-family: Aeroport !important; font-size: 20px">Заявка # {{ first_code_mpz_lst_first_elem }}</span>
                                        <table id="mpz_tbl" class=" table table-bordered"  style="margin-bottom: 30px; margin-top: 10px; width: 580px; max-width: 580px;" >
                                            <thead class="" style="padding: 0rem">
                                                <tr style="height: 26px; background-color: #577fae; padding: 0rem">
                                                  <th scope="col" style="width: 200px; max-width: 200px; min-width: 200px; text-align: center; padding: 0rem; vertical-align: middle">
                                                      <span style="color: #ffffff; font-weight: normal">Колодец</span>
                                                  </th>
                                                  <th scope="col" style="width: 140px; text-align: center; padding: 0rem; vertical-align: middle" >
                                                      <span style="color: #ffffff; font-weight: normal">
                                                          Всего в заявке
                                                      </span>
                                                  </th>
                                                  <th scope="col" style="width: 120px; text-align: center; padding: 0rem; vertical-align: middle" >
                                                      <span style="color: #ffffff; font-weight: normal">
                                                          Выдано
                                                      </span>
                                                  </th>
                                                  <th scope="col" style="width: 120px; text-align: center; padding: 0rem; vertical-align: middle" >
                                                      <span style="color: #ffffff; font-weight: normal">
                                                          К выдаче
                                                      </span>
                                                  </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for type in p_types %}
                                                    <tr  style="height: 40px; min-height: 30px; max-height: 30px;">
                                                      <td  id="tbl_row-{{ type }}" scope="row" style="text-align: center; padding: 0rem; vertical-align: middle" >{{ type.type_name }}</td>
                                                      <td  id="tbl_well_in_mpz_cont-{{ type }}" style="text-align: center; padding: 0rem; vertical-align: middle" class="">
                                                          <span style="z-index: 1" id="tbl_well_in_mpz-{{ type }}">{{ type.income }}</span>
                                                      </td>
                                                      <td  id="tbl_well_given-{{ type }}" style="text-align: center; padding: 0rem; vertical-align: middle" >{{ type.outcome }}</td>
                                                      <td  id="tbl_well_pathof-{{ type }}" style="text-align: center; padding: 0rem; vertical-align: middle" >{{ type.delta }}</td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>
                  </div>
                  <div class="modal-footer">
                    <button id="modal_transfer_cancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                    <button id="modal_transfer_save" type="button" class="btn btn-primary" onclick="">Переместить</button>
                  </div>
                </div>
              </div>
            </div>
        </form>
        {#=======================================================#}
        {#====================MODAL WELL LST ====================#}
        <form method="GET">
            <div class="modal fade" id="modal_well_lst" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document" style="margin-left: 1255px">
                <div class="modal-content" style="height: 759px">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Добавить колодцы</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  <div id="well_selected_array" hidden></div>
                    <div id="well_selected_counter" value="" hidden>0</div>
                  </div>
                  <div class="modal-body">
                    <div class="content-box" style="text-align:right; background-color: #ffffff;">
                        <div class="row">
                                <div class="column" style="margin-left: 15px">
                                    Тип колодца:
                                </div>
                                <div class="column" style="margin-left: 5px">
                                    <select id="modal_cb_type_lst" class="form-select" aria-label="Default select example">
                                        <option id="modal_cb_type_lst_first" value="{{ type_first_elem }}" selected>{{ type_first_elem }}</option>
                                          {% for type in types %}
                                                <tr>
                                                {% if type.pk > 1 %}
                                                    <tr>
                                                    <option value="{{ type.type_name }}">{{ type.type_name }}</option>
                                                    </tr>
                                                {% endif %}
                                                </tr>
                                            {% endfor %}
                                    </select>
                                </div>
                                <div class="col-sm-6" style="margin-left: -17px; padding-right: 0px;">Выбрано: </div>
                                <div id="well_counter" class="col-sm-1" style="margin-left: 2px">0</div>
                        </div>
                        <div class="row">
                                <div class="content-box" style="border: 1px solid #d2d2d2; width: 470px; margin-top: 10px; margin-left: 10px">
                                    <div class="row" style="border-bottom: 1px solid #d2d2d2; margin-left: 0px; width: 468px;">
                                        <th scope="col" ><span style="padding-left: 60px">Тип</span></th>
                                        <th scope="col"><span style="margin-left: 92px">Серийный номер</span></th>
                                        <th scope="col"><span style="margin-left: 49px">Произведен</span></th>
                                    </div>
                                    <div class="row" id="" >
                                        <div class="scroll" style="height: 527px; overflow-y: scroll">
                                        <table id="modal_well_lst_table" class="tree" style="margin-left: 10px; width: 467px;" >
                                            <tr id="123" onclick="tbl_well_click(id())">
                                                <td class="col-sm-4" style="padding-left: 0px; ">С-пласт</td>
                                                <td class="col-sm-4" style="padding-left: 45px; "></td>
                                                <td style="padding-right: 20px; text-align: right"></td>
                                            </tr>
                                        </table>
                                        </div>
                                    </div>
                                  </div>
                        </div>
                      </div>
                  </div>
                  <div class="modal-footer">
                    <button id="modal_well_lst_cancel" type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    <button id="modal_well_lst_save" type="button" class="btn btn-primary" onclick="add_well_to_trans_lst()">Добавить</button>
                  </div>
                </div>
              </div>
            </div>
        </form>
        {#=======================================================#}
        {#=======================MODAL M29=======================#}
        <form method="GET">
            <div class="modal fade" id="exampleModalCenter_m29" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" >
                <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 800px; width: 800px; max-height: 800px; height: 800px">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Отчет М29</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" style="">
                    <div class="content-box" style="background-color: #ffffff;">
                        <div class="row" style="margin-left: auto; margin-right: auto">
                            <div>
                                <a>Период от </a>
                                <td><input data-date-format="dd/mm/yyyy" id="m29_date_start" style="height: 23px; width: 105px; margin-left: 5px"></td>
                                <span id="m29_date_start_connect" hidden></span>
                                <a style="margin-left: 5px"> до </a>
                                <td><input data-date-format="dd/mm/yyyy" id="m29_date_end" style="height: 23px; width: 105px; margin-left: 5px;margin-right: 5px;"></td>
                                <span id="m29_date_end_connect" hidden></span>
                            </div>
                            <div class="content" style="margin-left: auto">
                                <button id="m29_get" name="but1" value="val_5" type="button" class="btn btn-warning btn-sm" style="margin-left: 0px;" onclick="modal_m29_get_data()">
                                    Сформировать
                                </button>
                                <button id="m29_save" name="but1" value="val_5" type="button" class="btn btn-info btn-sm" onclick="exportTableToExcel('m29_tbl')">
                                    Сохранить
                                </button>
                            </div>
                        </div>
                        <div class="row" style="padding-top: 20px; margin-left: auto; margin-right: auto; height: 700px; ">
                            <table id="m29_tbl" class=" table table-bordered"  style="margin-bottom: 30px; border: 1px" border="1">
                                <thead style="max-height: 30px; height: 30px">
                                    <tr style="margin: 0.1rem;">
                                      <th scope="col" style="text-align: center; width: 180px;background-color: #577fae; padding: 0.1rem; padding-bottom: 13px;">
                                          <a style="font-weight: normal; color: white;">
                                            Колодец
                                          </a>
                                      </th>
                                      <th scope="col" style="text-align: center; width: 150px;;background-color: #577fae;padding: 0.1rem; padding-bottom: 4px;">
                                          <a style="font-weight: normal; color: white">
                                            Сост. на начало <a id="m29_headtext_date_start" style="color: white;"></a>
                                          </a>
                                      </th>
                                      <th scope="col" style="text-align: center; width: 135px;background-color: #577fae;padding: 0.1rem; padding-bottom: 13px;">
                                          <a style="font-weight: normal; color: white">
                                            Приход
                                          </a>
                                      </th>
                                      <th scope="col" style="text-align: center; width: 135px;background-color: #577fae;padding: 0.1rem; padding-bottom: 13px;">
                                          <a style="font-weight: normal; color: white">
                                            Расход
                                          </a>
                                      </th>
                                      <th scope="col" style="text-align: center; width: 150px;background-color: #577fae;padding: 0.1rem; padding-bottom: 4px;">
                                          <a style="font-weight: normal; color: white">
                                            Сост. на конец <a id="m29_headtext_date_end" style="color: #ffffff;"></a>
                                          </a>
                                      </th>
                                    </tr>
                                </thead>
                                <tbody id="m29_tbl_body">
                                </tbody>
                            </table>
                        </div>
                      </div>
                  </div>
                </div>
              </div>
            </div>
        </form>
        {#=======================================================#}
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script type="text/javascript" src="/static/js/jquery.treegrid.js"></script>
        <script type="text/javascript">
        $(document).ready(function() {
            $('.tree').treegrid();
            $('.treegrid-1').exp
        });
        </script>
        <script>
            let islogined = window.sessionStorage.getItem('islogined')
            if (islogined == 'true') {
                document.getElementById('html_cont').style.filter = 'blur(0px)';
                document.getElementById('release').disabled = false;
                document.getElementById('transfer').disabled = false;
                document.getElementById('report').disabled = false;
                document.getElementById('statistic').disabled = false;
                document.getElementById('structure').disabled = false;
                document.getElementById('journal').disabled = false;
                console.log('user logged in')
            }
            else {
                $('#modalLogin').modal({backdrop: 'static', keyboard: false, style: ''})
                $('#modalLogin').modal('show')
            }
            $(document).ready(function() {

                let session = window.sessionStorage.getItem('session_token')
                let user = window.sessionStorage.getItem('session_user')

                var infoModal = $('#release_serial');
                var table = $('#well_table');
                var trans_type = $('#transaction_action_type');
                var appl_data_arr = {};

                $("#release").click(function(e) {
                    $.ajax({
                        type: "GET",
                        url: "/",
                        dataType: "json",
                        data: {
                        name: 'modal',
                        },
                        success: function(resp) {
                            $('#release_date').datepicker("setDate", new Date());
                            htmlData = resp.serial
                            infoModal.html(htmlData)
                        },
                        error: function(result) {
                            var readyState = {
                            1: "Loading",
                            2: "Loaded",
                            3: "Interactive",
                            4: "Complete"
                            };
                            if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                            }
                        }
                    });
                });
                $("#modal_transfer_save").click(function(e) {
                    let serial_lst_sourse = document.getElementById("connect_well_full").childNodes
                    if (serial_lst_sourse.length == 0) {
                        alert('СПИСОК КОЛОДЦЕВ ПУСТ!')
                    }
                    else {
                        let trans_date = ($('#transaction_date').val()).replaceAll('/', '.')
                        let trans_act_type = trans_type.val()
                        let trans_target = $('#transfer_code_num').val()
                        let trans_subtarget = $('#transfer_mpz_num').val()
                        let trans_serial_lst = ""
                        i = 0
                        for (;;){
                            if (i == serial_lst_sourse.length) {
                                    break
                                }
                                else {
                                    if (trans_serial_lst.length == 0) {
                                        trans_serial_lst = serial_lst_sourse.item(i).textContent
                                    }
                                    else {
                                        trans_serial_lst = trans_serial_lst + '%' + serial_lst_sourse.item(i).textContent
                                    }


                                }
                                i++
                        }
                        trans_serial_lst
                        $.ajax({
                            type: "GET",
                            url: "/",
                            dataType: "json",
                            data: {
                            event: 'transfer_well',
                                subevent: trans_act_type,
                                date: trans_date,
                                target: trans_target,
                                subtarget: trans_subtarget,
                                serial_lst: trans_serial_lst
                            },
                            success: function(resp) {
                                alert('КОЛОДЦЫ ПЕРЕМЕЩЕНЫ!')
                                document.getElementById('modal_transfer_cancel').click()
                                $("#well_table").load("/ #well_table > *");
                            },
                            error: function(result) {
                                var readyState = {
                                1: "Loading",
                                2: "Loaded",
                                3: "Interactive",
                                4: "Complete"
                                };
                                if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                    alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                                }
                            }
                        });
                    }
                });
                $("#transfer").click(function(e) {
                    document.getElementById('connect_well_arr').innerHTML = ""
                    document.getElementById('connect_well_type').innerHTML = ""
                    document.getElementById('transfer_well_lst').innerHTML = ""
                    document.getElementById('well_selected_array').innerHTML = ""
                    document.getElementById('well_selected_counter').innerHTML = 0
                    document.getElementById('well_counter').innerHTML = 0
                    document.getElementById('parent_count').innerHTML = 0
                    document.getElementById("serial_lst").innerHTML = "";
                    document.getElementById("connect_well_full").innerHTML = "";
                    $.ajax({
                        type: "GET",
                        url: "/",
                        dataType: "json",
                        data: {
                        event: 'get_init_transfer_data'
                        },
                        success: function(resp) {
                            appl_data_arr = resp
                        },
                        error: function(result) {
                            var readyState = {
                            1: "Loading",
                            2: "Loaded",
                            3: "Interactive",
                            4: "Complete"
                            };
                            if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                            }
                        }
                    });
                });
                $("#transfer_code_num").change(function(s) {

                    let cur_app_name = $("#transfer_code_num").val()
                    if (trans_type.val() === 'selling') {
                        document.getElementById("transfer_mpz_num").innerText = ''
                        i = 0
                        for (;;){
                            if (i == appl_data_arr[1].length) {
                                    break
                                }
                            else {
                                if (appl_data_arr[1][i][0] == cur_app_name) {
                                    $('#transfer_mpz_num').append('<option selected>'+appl_data_arr[1][i][1][0]+'</option>')
                                    cur_ind = i
                                    cur_first_name = appl_data_arr[1][i][1][0]
                                    document.getElementById('trans_modal_mpz_num').innerHTML = "Заявка # "+ cur_first_name + " (" + cur_app_name + ")"
                                }
                            }
                            i++
                        }
                        i = 0
                        for (;;){
                            if (i == appl_data_arr[1][cur_ind][1].length) {
                                    break
                                }
                                else {
                                    if (appl_data_arr[1][cur_ind][1][i] != cur_first_name) {
                                        $('#transfer_mpz_num').append('<option>'+appl_data_arr[1][cur_ind][1][i]+'</option>')
                                    }
                                }
                                i++
                        }
                    }
                    else {
                        document.getElementById("transfer_mpz_num").innerText = ''
                        i = 0
                        for (;;){
                            if (i == appl_data_arr[0].length) {
                                    break
                                }
                                else {
                                    if (appl_data_arr[0][i][0] == cur_app_name) {
                                        $('#transfer_mpz_num').append('<option selected>'+appl_data_arr[0][i][1][0]+'</option>')
                                        cur_ind = i
                                        cur_first_name = appl_data_arr[0][i][1][0]
                                        document.getElementById('trans_modal_mpz_num').innerHTML = "Заявка # "+cur_first_name

                                    }
                                }
                                i++
                        }
                        i = 0
                        for (;;){
                            if (i == appl_data_arr[0][cur_ind][1].length) {
                                    break
                                }
                                else {
                                    if (appl_data_arr[0][cur_ind][1][i] != cur_first_name) {
                                        $('#transfer_mpz_num').append('<option>'+appl_data_arr[0][cur_ind][1][i]+'</option>')

                                    }
                                }
                                i++
                        }
                    }
                });
                $("#transaction_action_type").change(function(s) {
                    if (trans_type.val() === 'selling'){
                        document.getElementById('transfer_field_text').innerHTML = 'Покупатель:';
                        first_buyer_name = appl_data_arr[1][0][0]
                        first_buyer_appl_name = appl_data_arr[1][0][1][0]
                        first_buyer_appl_lst = appl_data_arr[1][0][1]
                        document.getElementById('transfer_code_num').innerText = ''
                        document.getElementById('transfer_mpz_num').innerText = ''
                        $('#transfer_code_num').append('<option selected>'+first_buyer_name+'</option>')
                        $('#transfer_mpz_num').append('<option selected>'+first_buyer_appl_name+'</option>')
                        document.getElementById('trans_modal_mpz_num').innerHTML = "Заявка # "+first_buyer_appl_name + "(" + first_buyer_name + ")"
                        let i = 0
                        for (;;){
                            if (i == appl_data_arr[1].length) {
                                    break
                                }
                                else {
                                    if (appl_data_arr[1][i][0] != first_buyer_name) {
                                        $('#transfer_code_num').append('<option>'+appl_data_arr[1][i][0]+'</option>')
                                    }

                                }
                                i++
                        }
                        i = 0
                        for (;;){
                            if (i == appl_data_arr[1][0][1].length) {
                                    break
                                }
                                else {
                                    if (appl_data_arr[1][0][1][i] != first_buyer_appl_name) {
                                        $('#transfer_mpz_num').append('<option>'+appl_data_arr[1][0][1][i]+'</option>')
                                    }

                                }
                                i++
                        }
                    }else {
                        document.getElementById('transfer_field_text').innerHTML = 'Шифр:';
                        document.getElementById('transfer_field_text').innerHTML = 'Покупатель:';
                        first_code_name = appl_data_arr[0][0][0]
                        first_code_appl_name = appl_data_arr[0][0][1][0]
                        first_code_appl_lst = appl_data_arr[0][0][1]
                        document.getElementById('transfer_code_num').innerText = ''
                        document.getElementById('transfer_mpz_num').innerText = ''
                        $('#transfer_code_num').append('<option selected>'+first_code_name+'</option>')
                        $('#transfer_mpz_num').append('<option selected>'+first_code_appl_name+'</option>')
                        document.getElementById('trans_modal_mpz_num').innerHTML = "Заявка # "+first_code_appl_name
                        let i = 0
                        for (;;){
                            if (i == appl_data_arr[0].length) {
                                    break
                                }
                                else {
                                    if (appl_data_arr[0][i][0] != first_code_name) {
                                        $('#transfer_code_num').append('<option>'+appl_data_arr[0][i][0]+'</option>')
                                    }

                                }
                                i++
                        }
                        i = 0
                        for (;;){
                            if (i == appl_data_arr[0][0][1].length) {
                                    break
                                }
                                else {
                                    if (appl_data_arr[0][0][1][i] != first_code_appl_name) {
                                        $('#transfer_mpz_num').append('<option>'+appl_data_arr[0][0][1][i]+'</option>')
                                    }

                                }
                                i++
                        }
                    }



                });
                $("#modal_cb_type_lst").change(function(s) {
                    var type = $('#modal_cb_type_lst').val()
                    document.getElementById("well_selected_counter").innerHTML = "0";
                    document.getElementById("well_selected_counter").value = "";
                    document.getElementById("well_counter").innerText = "0";
                    document.getElementById("well_selected_array").innerHTML = "";

                    document.getElementById("modal_well_lst_table").innerHTML = "";
                    document.getElementById("modal_well_lst_table").innerHTML = "";

                    $.ajax({
                        type: "GET",
                        url: "/",
                        dataType: "json",
                        data: {
                        event: 'get_well_lst',
                            type: $('#modal_cb_type_lst').val()
                        },

                        success: function(resp) {

                            $("#well_table").load("/ #well_table > *");
                            var p_arr = document.getElementById("serial_lst").childNodes
                            for (const [key, value] of Object.entries(resp)) {
                                var fl = true
                                console.log(value[1])
                                i = 0
                                for (;;){
                                    if (i == p_arr.length) {
                                        break
                                    }
                                    else {
                                            console.log('========================')
                                            console.log(value[1])
                                            console.log(p_arr.item(i).textContent)
                                        if (p_arr.item(i).textContent.search(value[1]) != -1) {
                                            fl = false
                                        }

                                    }
                                    i++
                                }
                                if (fl == true) {
                                    $('#modal_well_lst_table').append('' +
                                    '<tr class="" id="'+value[1]+'" style="background-color: white; cursor: pointer;"  onclick="tbl_well_click(id)" >\n' +
                                    '<td class="col-sm-5" style="padding-left: 20px; ">С-пласт '+value[0]+'</td>\n' +
                                    '<td class="col-sm-4" style="padding-left: 22px; ">'+value[1]+'</td>\n' +
                                    '<td style="padding-right: 24; text-align: right">'+value[2]+'</td>\n' +
                                    '</tr>'
                                    );
                                }
                            }
                        },
                        error: function(result) {
                            var readyState = {
                            1: "Loading",
                            2: "Loaded",
                            3: "Interactive",
                            4: "Complete"
                            };
                            if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                            }
                        }
                    });
                });
                $("#modal_save").click(function(s) {
                    $.ajax({
                        type: "GET",
                        url: "/",
                        dataType: "json",
                        data: {
                        event: 'release',
                            date: $('#release_date').val(),
                            type: $('#release_type').val(),
                            serial: htmlData,
                            wh: $('#release_wh').val()
                        },
                        success: function(resp) {
                            document.getElementById('modal_cancel').click()
                            alert('Колодец выпущен!')
                            $("#well_table").load("/ #well_table > *");
                        },
                        error: function(result) {
                            var readyState = {
                            1: "Loading",
                            2: "Loaded",
                            3: "Interactive",
                            4: "Complete"
                            };
                            if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                            }
                        }
                    });
                });
                $("#modalLogin_login").focus(function (s) {
                    document.getElementById('modalLogin_login_error').hidden = true
                })
                $("#modalLogin_password").focus(function (s) {
                    document.getElementById('modalLogin_password_error').hidden = true
                })
                $("#transfer_mpz_num").change(function (s) {
                    if (trans_type.val() === 'selling') {
                        document.getElementById('trans_modal_mpz_num').innerHTML = "Заявка # "+ $("#transfer_mpz_num").val() + " (" + $("#transfer_code_num").val() + ")"
                    }
                    else {
                        document.getElementById('trans_modal_mpz_num').innerHTML = "Заявка # "+ $("#transfer_mpz_num").val()
                    }
                })
            });
            var input_password = document.getElementById("modalLogin_password");
            var input_login = document.getElementById("modalLogin_login");
            var session_token = ''
            input_password.addEventListener("keyup", function(event) {
              if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("modal_login_save").click();
              }
            });
            input_login.addEventListener("keyup", function(event) {
              if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("modal_login_save").click();
              }
            });
            $('#release_date').datepicker({
                weekStart: 1,
                daysOfWeekHighlighted: "6,0",
                autoclose: true,
                todayHighlight: true,
            });
            $('#release_date').datepicker("setDate", new Date());
            $('.dropdown-toggle').dropdown();
            $('#transaction_date').datepicker({
                weekStart: 1,
                daysOfWeekHighlighted: "6,0",
                autoclose: true,
                todayHighlight: true,
            });
            $('#transaction_date').datepicker("setDate", new Date());
            $('#m29_date_start').datepicker({
                weekStart: 1,
                daysOfWeekHighlighted: "6,0",
                autoclose: true,
                todayHighlight: true,
            });
            $('#m29_date_start').datepicker("setDate", new Date());
            $('#m29_date_start').datepicker("setDate", "-1m");
            $('#m29_date_end').datepicker({
                minDate:'-3M 0D',
                weekStart: 1,
                daysOfWeekHighlighted: "6,0",
                autoclose: true,
                todayHighlight: true,
            });
            $('#m29_date_end').datepicker("setDate", new Date());

            function initWellTbl(name) {
                    document.getElementById('well_counter').innerHTML = 0;
                    document.getElementById('well_selected_array').innerHTML = ""
                    document.getElementById('well_selected_counter').innerHTML = 0
                    type_name = $('#modal_cb_type_lst_first').val()
                    document.getElementById("modal_well_lst_table").innerHTML = "";
                    $("#modal_cb_type_lst").val($("#modal_cb_type_lst option:first").val());
                    $.ajax({
                        type: "GET",
                        url: "/",
                        dataType: "json",
                        data: {
                        event: 'get_well_lst',
                            type: type_name
                        },
                        success: function(resp) {
                            $("#well_table").load("/ #well_table > *");
                            var p_arr = document.getElementById("serial_lst").childNodes
                            console.log(p_arr)
                            for (const [key, value] of Object.entries(resp)) {
                                var fl = true
                                console.log(value[1])
                                i = 0
                                for (;;){
                                    if (i == p_arr.length) {
                                        break
                                    }
                                    else {
                                            console.log('========================')
                                            console.log(value[1])
                                            console.log(p_arr.item(i).textContent)
                                        if (p_arr.item(i).textContent.search(value[1]) != -1) {
                                            fl = false
                                        }
                                    }
                                    i++
                                }
                                if (fl == true) {
                                    $('#modal_well_lst_table').append('' +
                                    '<tr class="" id="'+value[1]+'" style="background-color: white; cursor: pointer;"  onclick="tbl_well_click(id)" >\n' +
                                    '<td class="col-sm-5" style="padding-left: 20px; ">С-пласт '+value[0]+'</td>\n' +
                                    '<td class="col-sm-4" style="padding-left: 22px; ">'+value[1]+'</td>\n' +
                                    '<td style="padding-right: 24; text-align: right">'+value[2]+'</td>\n' +
                                    '</tr>'
                                    );
                                }
                            }
                        },
                        error: function(result) {
                            var readyState = {
                            1: "Loading",
                            2: "Loaded",
                            3: "Interactive",
                            4: "Complete"
                            };
                            if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                            }
                        }
                    });
                };
            function tbl_well_click(name) {

                    var nodes = document.querySelectorAll('#well_selected_array *')
                    var sel_serial = name
                    var i = 0
                    var check = false
                    check = false
                    if (nodes.length == 0) {
                        $('#well_selected_array').append('<span id="arr_'+name+'">'+name+'</span>');
                        nodes = document.querySelectorAll('#well_selected_array *')
                        document.getElementById('well_selected_counter').innerHTML = parseInt(nodes.length, 10)
                        document.getElementById(name).style.backgroundColor = "#eeeeee";
                    }
                    else {
                        for ([key, value] of Object.entries(nodes)) {
                            if (value.innerHTML == name) {
                                document.getElementById(name).style.backgroundColor = "#ffffff";
                                document.getElementById('arr_'+name+'').remove()
                                nodes = document.querySelectorAll('#well_selected_array *')
                                document.getElementById('well_selected_counter').innerHTML = parseInt(nodes.length, 10)
                                check = true
                                break
                            }
                        }
                        if (check == false) {
                            $('#well_selected_array').append('<span id="arr_'+name+'">'+name+'</span>');
                            nodes = document.querySelectorAll('#well_selected_array *')
                            document.getElementById('well_selected_counter').innerHTML = parseInt(nodes.length, 10)
                            document.getElementById(name).style.backgroundColor = "#eeeeee";
                        }
                    }
                    document.getElementById('well_counter').innerText = nodes.length
                };
            function add_well_to_trans_lst(name) {
                    var tbl_nodes = document.getElementById('transfer_well_lst').childNodes
                    var lst_sub_count = document.getElementById('connect_well_arr').childElementCount
                    var sub_type = document.getElementById('connect_well_type').innerHTML
                    var sub_arr = document.getElementById('connect_well_arr').childNodes
                    document.getElementById('modal_well_lst_cancel').click()
                    document.getElementById("connect_well_arr").innerHTML = document.getElementById("well_selected_array").innerHTML
                    $("#connect_well_full").append(document.getElementById("well_selected_array").innerHTML)
                    document.getElementById("connect_well_type").innerHTML = document.getElementById("modal_cb_type_lst").value
                    if (tbl_nodes.length == 0) {
                        $('#transfer_well_lst').append('<tr class="treegrid-1" id = "parent-1" >\n' +
        '                                                   <td id = "1">С-пласт '+document.getElementById('connect_well_type').innerHTML+'</td><td id="elem_count-1">'+document.getElementById('connect_well_arr').childElementCount+'</td>\n' +
                                                        '</tr>');
                        document.getElementById('parent_count').innerHTML = parseInt(document.getElementById('parent_count').textContent) + 1
                        var i = 0
                       for (;;) {
                           $('#transfer_well_lst').append('<tr class="treegrid-parent-1" id="child-1-'+i+'">\n' +
        '                                                      <td id = "">'+document.getElementById('connect_well_arr').childNodes[i].textContent+'</td><td></td>\n' +
        '                                                      </tr>');
                           i++
                           if (i == document.getElementById('connect_well_arr').childElementCount) break;
                       }
                    $('#transfer_well_lst').treegrid();
                    }
                    else {
                        var i = 0
                        var par_ind = 0
                        var isNew = true
                        for (;;) {
                            var sub_type = document.getElementById('connect_well_type').innerHTML
                           if (i == tbl_nodes.length) {break}
                            else {
                                var ch = tbl_nodes.item(i).childNodes
                                if (tbl_nodes.item(i).id.search("parent") != -1) {
                                    console.log('PAR IND INC: '+par_ind)
                                    par_ind++
                                    if (tbl_nodes.item(i).textContent.search(sub_type) != -1) {
                                                                        var par_id = ch.item(1).id
                                    console.log('elem_count-'+(par_ind))
                                    var par_ch_len = document.getElementById('elem_count-'+(par_ind)).textContent
                                    console.log('LEN: '+par_ch_len)

                                    isNew = false
                                    var j = 0
                                    for (;;) {
                                        if (j == document.getElementById('connect_well_arr').childElementCount) {
                                            console.log('IMPORT ELEM COMPLETE')
                                            $('#transfer_well_lst').treegrid();
                                            break;
                                        }
                                        else {
                                             var par_ch_len = document.getElementById('elem_count-'+(par_ind)).textContent
                                             $('#child-'+par_id+'-'+(par_ch_len-1+parseInt(j,10))).after('<tr class="treegrid-parent-'+ch.item(1).id+'" id="child-'+par_id+'-'+(parseInt(par_ch_len,10)+parseInt(j,10))+'">\n' +
                                            '<td id = "">'+document.getElementById('connect_well_arr').childNodes[j].textContent+'</td><td></td>\n' +
                                            '</tr>');
                                             console.log(sub_arr.length)
                                            j++
                                        }
                                    }
                                    document.getElementById('elem_count-'+(par_ind)).innerText = parseInt(document.getElementById('elem_count-'+(par_ind)).textContent, 10) + parseInt(sub_arr.length, 10)
                                    i++
                                    }
                                    i++
                                }
                                else {
                                    i++
                                }
                           }
                        }
                        if (isNew == true) {
                            console.log('NEW PARENT ELEM!')
                            document.getElementById('parent_count').innerHTML = parseInt(document.getElementById('parent_count').textContent) + 1
                            $('#transfer_well_lst').append('<tr class="treegrid-'+document.getElementById('parent_count').textContent+'" id = "parent-'+document.getElementById('parent_count').textContent+'" >\n' +
                                                            '<td id = "'+document.getElementById('parent_count').textContent+'">С-пласт '+document.getElementById('connect_well_type').innerHTML+'</td><td id="elem_count-'+document.getElementById('parent_count').textContent+'">'+document.getElementById('connect_well_arr').childElementCount+'</td>\n' +
                                                            '</tr>');

                            var i = 0
                            for (;;) {
                            $('#transfer_well_lst').append('<tr class="treegrid-parent-'+document.getElementById('parent_count').textContent+'" id="child-'+document.getElementById('parent_count').textContent+'-'+i+'">\n' +
                                                            '<td id = "">'+document.getElementById('connect_well_arr').childNodes[i].textContent+'</td><td></td>\n' +
                                                            '</tr>');
                            i++
                            if (i == document.getElementById('connect_well_arr').childElementCount) break;

                            }
                            $('#transfer_well_lst').treegrid();
                        }
                    }
                    i = 0
                    for (;;) {
                        if (i == sub_arr.length) {
                            break
                        }
                        else
                            document.getElementById("serial_lst").append('<span id="">'+sub_arr.item(i).textContent+'</span>')
                            i++
                    }

                    console.log(document.getElementById("serial_lst").childNodes)
                    document.getElementById("transfer_well_counter").innerHTML = document.getElementById("serial_lst").childNodes.length
                };
            function modal_m29_init() {
                document.getElementById('m29_tbl_body').innerHTML = "";
                $('#m29_date_start').datepicker("setDate", "-1m");
                $('#m29_date_end').datepicker("setDate", "-0m");
                document.getElementById('m29_date_start_connect').innerHTML = $('#m29_date_start').val()
                document.getElementById('m29_date_end_connect').innerHTML = $('#m29_date_end').val()
                document.getElementById('m29_headtext_date_start').innerText = $('#m29_date_start').val()
                document.getElementById('m29_headtext_date_end').innerText = $('#m29_date_end').val()
                $.ajax({
                    type: "GET",
                    url: "/",
                    dataType: "json",
                    data: {
                    event: 'm29_get_data',
                        start_time: 'null',
                        end_time: 'null'
                    },
                    success: function(resp) {

                        let data_arr = resp[0]
                        console.log(data_arr.length)
                        i = 0
                        for (;;) {
                            if (i == data_arr.length) {
                                break
                            }
                            else {
                                if (data_arr[i][1] == "0") {
                                    color_data_1 = '#aeaeae'
                                    text_weight_1 = 'normal'
                                }
                                else {
                                    color_data_1 = '#000000'
                                    text_weight_1 = 'bold'
                                }
                                if (data_arr[i][2] == "0") {
                                    color_data_2 = '#aeaeae'
                                    text_weight_2 = 'normal'
                                }
                                else {
                                    color_data_2 = '#000000'
                                    text_weight_2 = 'bold'
                                }
                                if (data_arr[i][3] == "0") {
                                    color_data_3 = '#aeaeae'
                                    text_weight_3 = 'normal'
                                }
                                else {
                                    color_data_3 = '#000000'
                                    text_weight_3 = 'bold'
                                }
                                if (data_arr[i][4] == "0") {
                                    color_data_4 = '#aeaeae'
                                    text_weight_4 = 'normal'
                                }
                                else {
                                    color_data_4 = '#000000'
                                    text_weight_4 = 'bold'
                                }
                                $("#m29_tbl_body").append("<tr> <td scope=\"row\" style=\"text-align: center; height:30px;\" >С-пласт "+data_arr[i][0]+"</td>\n" +
                                                            "<td style=\"text-align: center; color: "+color_data_1+";font-weight: "+text_weight_1+"\">"+data_arr[i][1]+"</td>\n" +
                                                            "<td style=\"text-align: center; color: "+color_data_3+";font-weight: "+text_weight_3+"\">"+data_arr[i][3]+"</td>\n" +
                                                            "<td style=\"text-align: center; color: "+color_data_4+";font-weight: "+text_weight_4+"\">"+data_arr[i][4]+"</td>\n" +
                                                            "<td style=\"text-align: center; color: "+color_data_2+";font-weight: "+text_weight_2+"\">"+data_arr[i][2]+"</td> </tr>")
                                i++
                            }
                        }
                    },
                    error: function(result) {
                        var readyState = {
                        1: "Loading",
                        2: "Loaded",
                        3: "Interactive",
                        4: "Complete"
                        };
                        if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                            alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                        }
                    }
                });
            };
            function modal_m29_get_data() {
                document.getElementById('m29_tbl_body').innerHTML = ""
                document.getElementById('m29_date_start_connect').innerHTML = $('#m29_date_start').val()
                document.getElementById('m29_date_end_connect').innerHTML = $('#m29_date_end').val()
                document.getElementById('m29_headtext_date_start').innerText = $('#m29_date_start').val()
                document.getElementById('m29_headtext_date_end').innerText = $('#m29_date_end').val()
                time_start = $("#m29_date_start").datepicker("getDate")
                time_end = $("#m29_date_end").datepicker("getDate")
                if (time_start - time_end > 0) {alert('ПЕРИОД ЗАДАН НЕ ВЕРНО!')}
                console.log('type: '+time_start)
                $.ajax({
                    type: "GET",
                    url: "/",
                    dataType: "json",
                    data: {
                    event: 'm29_get_data',
                        start_time: $('#m29_date_start').val(),
                        end_time: $('#m29_date_end').val()
                    },
                    success: function(resp) {
                        document.getElementById('m29_tbl_body').innerHTML = ""
                        let data_arr = resp[0]
                        console.log(data_arr.length)
                        i = 0
                        for (;;) {
                            if (i == data_arr.length) {
                                break
                            }
                            else {
                                if (data_arr[i][1] == "0") {
                                    color_data_1 = '#aeaeae'
                                    text_weight_1 = 'normal'
                                }
                                else {
                                    color_data_1 = '#000000'
                                    text_weight_1 = 'bold'
                                }
                                if (data_arr[i][2] == "0") {
                                    color_data_2 = '#aeaeae'
                                    text_weight_2 = 'normal'
                                }
                                else {
                                    color_data_2 = '#000000'
                                    text_weight_2 = 'bold'
                                }
                                if (data_arr[i][3] == "0") {
                                    color_data_3 = '#aeaeae'
                                    text_weight_3 = 'normal'
                                }
                                else {
                                    color_data_3 = '#000000'
                                    text_weight_3 = 'bold'
                                }
                                if (data_arr[i][4] == "0") {
                                    color_data_4 = '#aeaeae'
                                    text_weight_4 = 'normal'
                                }
                                else {
                                    color_data_4 = '#000000'
                                    text_weight_4 = 'bold'
                                }
                                $("#m29_tbl_body").append("<tr> <td scope=\"row\" style=\"text-align: center; height:30px;\" >С-пласт "+data_arr[i][0]+"</td>\n" +
                                                            "<td style=\"text-align: center; color: "+color_data_1+";font-weight: "+text_weight_1+"\">"+data_arr[i][1]+"</td>\n" +
                                                            "<td style=\"text-align: center; color: "+color_data_3+";font-weight: "+text_weight_3+"\">"+data_arr[i][3]+"</td>\n" +
                                                            "<td style=\"text-align: center; color: "+color_data_4+";font-weight: "+text_weight_4+"\">"+data_arr[i][4]+"</td>\n" +
                                                            "<td style=\"text-align: center; color: "+color_data_2+";font-weight: "+text_weight_2+"\">"+data_arr[i][2]+"</td> </tr>")
                                i++
                            }
                        }
                    },
                    error: function(result) {
                        var readyState = {
                        1: "Loading",
                        2: "Loaded",
                        3: "Interactive",
                        4: "Complete"
                        };
                        if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                            alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                        }
                    }
                });
            };
            function check_login() {
                console.log('check login')
                let login_data = $('#modalLogin_login').val()
                let password_data = $('#modalLogin_password').val()
                let check_login_empty = false
                let check_password_empty = false
                console.log(login_data)
                console.log(login_data.length)
                console.log(password_data)
                console.log(password_data.length)
                if (login_data.length == 0) {
                    document.getElementById('modalLogin_login_error').innerHTML = 'введите логин'
                    document.getElementById('modalLogin_login_error').hidden = false
                    check_login_empty = true
                }
                if (password_data.length == 0) {
                    document.getElementById('modalLogin_password_error').innerHTML = 'введите пароль'
                    document.getElementById('modalLogin_password_error').hidden = false
                    check_password_empty = true
                }
                if ((check_login_empty == false) && (check_password_empty == false)) {
                     $.ajax({
                        type: "GET",
                        url: "/",
                        dataType: "json",
                        data: {
                        name: 'check_login',
                            login: login_data,
                            password: password_data,
                        },
                        success: function(resp) {
                            document.getElementById('html_cont').style.filter = 'blur(0px)';
                            document.getElementById('release').disabled = false;
                            document.getElementById('transfer').disabled = false;
                            document.getElementById('report').disabled = false;
                            document.getElementById('statistic').disabled = false;
                            document.getElementById('structure').disabled = false;
                            document.getElementById('journal').disabled = false;
                            console.log('resp')
                            console.log(resp)
                            if (resp.result == 'success') {
                                window.sessionStorage.setItem('islogined', 'true');
                                window.sessionStorage.setItem('islogined', 'true');

                                document.getElementById('modal_login_cancel').click()
                            }
                            else {
                                document.getElementById('modalLogin_password_error').innerHTML = 'неверный логин или пароль'
                                document.getElementById('modalLogin_password_error').hidden = false
                            }
                        },
                        error: function(result) {
                            var readyState = {
                            1: "Loading",
                            2: "Loaded",
                            3: "Interactive",
                            4: "Complete"
                            };
                            if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                            }
                        }
                    });
                }
            }
            function main_reload() {
                window.location.reload(true)
                window.sessionStorage.setItem('islogined', 'true');
            }
            function goStructure() {
                window.sessionStorage.setItem('islocallogined', 'true')
            }
            function goStatistic() {
                window.sessionStorage.setItem('islocallogined', 'true')
            }
            function exportTableToExcel(tableID){
                var downloadLink;
                var dataType = 'application/vnd.ms-excel';
                var tableSelect = document.getElementById(tableID);
                var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20').replace(/#/g, '%23');
                date_start = (document.getElementById('m29_date_start_connect').textContent).replace('/', '-').replace('/', '-')
                date_end = (document.getElementById('m29_date_end_connect').textContent).replace('/', '-').replace('/', '-')
                console.log(date_start)
                console.log(date_end)
                filename = date_start + '__' + date_end
                filename = filename?filename+'.xls':'excel_data.xls';
                downloadLink = document.createElement("a");
                document.body.appendChild(downloadLink);
                if(navigator.msSaveOrOpenBlob){
                    var blob = new Blob(['\ufeff', tableHTML], {
                        type: dataType
                    });
                    navigator.msSaveOrOpenBlob( blob, filename);
                }else{
                    downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
                    downloadLink.download = filename;
                    downloadLink.click();
                }
            }
            function createMpzApplTbl(mpz_name) {

            }
            function createMpzApplTbl(appl_name, mpz_name) {

            }
        </script>
    </body>
</html>

