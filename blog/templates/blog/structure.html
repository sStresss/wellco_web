{% load static %}
<html lang="en">
    <head>
        <title>sinaps.workspace</title>
        <link rel="shortcut icon" href="{% static '/image/favicon.ico' %}" type="image/x-icon">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker.min.css" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css?family=Lobster&subset=latin,cyrillic" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="{% static 'css/styles.css' %}">
        <link rel="stylesheet" href="{% static 'css/jquery.treegrid.css' %}">
        <link rel="stylesheet" href="{% static 'css/blog.css' %}">
        <link rel="stylesheet" href="{% static 'css/animate.min.css' %}" />
    </head>
    <body>
        <div class="background-container" style="height: 904px">
            <div id="picoutput"></div>
            <div class="page-header">
                <div class="row" style="max-height: 60px; margin-left: 0px; margin-right: 0px">
                    <div class="col-sm-1" style="max-height: 60px ;vertical-align: center; margin-left: -15px">
                        <img src="{% static '/image/sinaps_.png' %}" alt="" class="wow animate__animated animate__rotateIn" style="visibility: visible; animation-duration: 5s;height: 45px; margin-top: 7px">
                    </div>
                    <div class="col-sm-8" style="max-height: 60px; margin-left: -98px">
                        <a class="head_title" style=" cursor: pointer; margin-left: 10px; margin-top: 5px;" onclick="backMain()">
                            <div class="row" style="cursor: pointer;width: 800px" onclick="backMain()">
                                <div class="column" style="margin-left: 16px">
                                   <h1 style="max-height: 40px; margin-top: 10px">
                                        <a style="margin-left: -25px; font-family: Aeroport;height: 20px; max-height: 20px; font-size: 30px;">
                                            С-ПЛАСТ →
                                        </a>
                                    </h1>
                                </div>
                                <div class="column" style="">
                                    <h1 style="max-height: 40px; margin-top: 8px; margin-left: 8px">
                                        <a style="margin-left: 0px; font-family: Aeroport;height: 20px; max-height: 20px; font-size: 30px;"> управление заявками</a>
                                    </h1>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="column" style="margin-left: auto; margin-right: 0px;  margin-top: 7px; font-family: Aeroport !important;">
                        <a class="link-hover-solid" href="{% url 'post_list' %}" style="color: white">
                            Главная
                        </a>
                    </div>
                    <div class="column" style="margin-left: 30px; margin-right: 50px;  margin-top: 7px; font-family: Aeroport !important;">
                        <a class="link-hover-solid" href="{% url 'statistic' %}" style="color: white;">
                            Статистика
                        </a>
                    </div>
                </div>
            </div>
            <div class="row" style="width: 100%; margin-top: 0px; background-color: #f4f7fe; margin-left: 0px; height: 860px">
                <div class="" style="background-color: #e3e7ef; padding-left: -15px; margin-left: -15px">
                    <div class="col-sm-2" style="border-right: none; max-width: 248px; margin-left: 40px; margin-top: 0px;">
                        <div  style="height: 35px; margin-left: 15px; margin-top: 10px">
                            <div class="row" style="background-color: #e3e7ef; margin-left: -75px; margin-top: -10px; border-bottom: 1px solid #939393">
                                <div class="row" style="margin-left: 25px">
                                    <select id="cb_tree" class="form-select custom_hov" aria-label="Default select example" style="width: 214px; height: 34px; font-size: 18px; border: none; outline: none; margin-left: 20px; margin-bottom: 5px; color: #000000; background-color: #e3e7ef">
                                        <option id="pg" value="pg" selected>Проектные группы</option>
                                        <tr>
                                        <option id="os" value="os">Сторонние продажи</option>
                                        </tr>
                                    </select>
                                    <button id="addPG" name="but1" value="val_6" type="button" class="btn btn-light btn-sm" style="height: 24px; width: 24px; margin-left: 2px;margin-top: 7px ; background-color: #e3e7ef; outline: #e3e7ef; border: none" data-toggle="modal" data-target="#modalNewPg" onclick="">
                                        <h1 style="margin-top: -10px; margin-left: -4px; color: #000000">+</h1>
                                    </button>
                                    <button id="addBY" name="but2" value="val_6" type="button" class="btn btn-light btn-sm" style="height: 24px; width: 24px; margin-left: 2px;margin-top: 7px ; background-color: #e3e7ef; outline: #e3e7ef; border: none" data-toggle="modal" data-target="#modalNewBy" onclick="" hidden>
                                        <h1 style="margin-top: -10px; margin-left: -4px; color: #000000">+</h1>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="tbl_cont" class="row" style=" margin-top: 5px; margin-left: -40px; margin-right: -15px;">
                            <table id="table_struct" class="tree" style="width: 350px; ">
                                {% for pg  in pg_lst %}
                                    <tr id="node-{{ pg.pk }}" class="custom_hov treegrid-{{ pg.pk }}" style="height: 25px; max-height: 25px; color: #000000;">
                                        <td style="max-width: 200px;width: 200px;padding-left: 25px">{{ pg.pg_name }}</td>
                                        <td style="text-align: right;">
                                            <button id="addCode" name="{{ pg.pk }}" value="val_6" type="button" class="btn btn-light btn-sm" data-toggle="modal" data-target="#modalNewCode" style="height: 20px; width: 20px; margin-left: 19px; margin-right: 19px; background-color: #e3e7ef; border: none" onclick="takePgName(name)">
                                                <h5 style="margin-top: -8px; margin-left: -5px; color: #4f565c; font-weight: normal">+</h5>
                                            </button>
                                        </td>
                                        <td style="text-align: right">
                                            <button id="delPG-{{ pg.pk }}" name="{{ pg.pk }}" value="val_6" type="button" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: -15px; margin-right: 10px; background-color: #e3e7ef; border: none" data-toggle="modal" data-target="#modalDellPg" onclick="del_pg_get_modal(name)">
                                                <h5 style="margin-top: -8px; margin-left: -2px; color: #4f565c; font-weight: normal">-</h5>
                                            </button>
                                        </td>
                                    </tr>
                                    {% for code  in code_lst %}
                                        {% if  code.connect_id == pg.id %}
                                            <tr class="custom_hov treegrid-{{ pg.pk }}{{ code.id }} treegrid-parent-{{ pg.pk }}" style="width: 100px; height: 25px; max-height: 25px; margin-left: 0px; color: #000000">
                                                <td style="padding-left: 30px">#{{ code.code_name }}</td>
                                                <td style="text-align: right">
                                                    <button id="addMPZ-{{ code.pk }}" name="{{ code.pk }}" value="val_6" type="button" class="btn btn-light btn-sm" data-toggle="modal" data-target="#modalNewMpz" style=" height: 20px; width: 20px; margin-left: 19px; margin-right: 19px ; background-color: #e3e7ef; alignment: right; border: none" onclick="takeCodeName(name)">
                                                        <h5 style="margin-top: -8px; margin-left: -5px; color: #112945; font-weight: normal">+</h5>
                                                    </button>
                                                </td>
                                                <td style="text-align: right">
                                                    <button id="delCode-{{ code.pk }}" name="{{ code.pk }}" value="val_6" type="button" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: -15px; margin-right: 10px ; background-color: #e3e7ef; border: none" data-toggle="modal" data-target="#modalDellCode" onclick="takeCodeName(name)">
                                                        <h5 style="margin-top: -8px; margin-left: -2px; color: #112945; font-weight: normal">-</h5>
                                                    </button>
                                                </td>
                                            </tr>
                                            {% for mpz  in mpz_lst %}
                                                {% if  mpz.connect_id == code.id %}
                                                    <tr id="{{ mpz.pk }}" class="custom_hov treegrid-parent-{{ pg.pk }}{{ code.id }}" style="height: 25px; max-height: 25px; color: #000000">
                                                        <td id="mpz_name-{{ mpz.pk }}" style=" padding-left: 35px; ">МПЗ №{{ mpz.mpz_appl_name }}</td>
                                                        <td style="text-align: right">
                                                            <button id="infoMPZ-{{ mpz.pk }}" name="{{ mpz.pk }}" value="" type="button" data-toggle="tooltip" data-placement="top" title="info" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: 19px;margin-right: 19px; background-color: #e3e7ef; border: none" onclick="get_mpz_data(name, {{ pg.pk }})">
                                                                <h5 style="margin-top: -7px; margin-left: -1px; color: #112945; font-weight: normal">i</h5>
                                                            </button>
                                                        </td>
                                                        <td style="text-align: right">
                                                            <button id="dellMPZ-{{ mpz.pk }}" name="{{ mpz.pk }}" value="val_6" type="button" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: -15px; margin-right: 10px; background-color: #e3e7ef; border: none" data-toggle="modal" data-target="#modalDellMpz" onclick="del_mpz_get_modal(name)">
                                                                <h5 style="margin-top: -8px; margin-left: -2px; color: #112945; font-weight: normal">-</h5>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>
                <div class="column" style="margin-left: 0px; margin-top: 40px">
                    <div class=" container row" style="margin-top: -39px; width: 1375px; min-width: 1375px">
                        <div class="column" style="padding-left:10px;width: 590px; min-width: 590px; background-color: white; height: 859px; width: 44.5%">
                            <div class="row" style="height: 61px; margin-left: 0px">
                                <h1 id="mpz_tbl_head_text" style="margin-left: 0px; margin-top: 10px" hidden>
                                    Заявка # ___
                                </h1>
                                <h1 id="mpz_tbl_head_text_first" style="margin-left: 0px; margin-top: 10px">Выберите заявку</h1>
                            </div>
                            <table id="mpz_tbl" class=" table table-bordered"  style="margin-bottom: 30px; margin-top: -10px; width: 580px; max-width: 580px;" hidden>
                                <thead class="">
                                    <tr style="height: 30px; background-color: #577fae;">
                                      <th scope="col" style="width: 200px; max-width: 200px; min-width: 200px; text-align: center;"><h1 id="GlobalMpzNumConnect" hidden></h1>
                                          <span style="color: #ffffff; font-weight: normal">Колодец</span>
                                      </th>
                                      <th scope="col" style="width: 140px; text-align: center" >
                                          <span style="color: #ffffff; font-weight: normal">
                                              Всего в заявке
                                          </span>
                                      </th>
                                      <th scope="col" style="width: 120px; text-align: center" >
                                          <span style="color: #ffffff; font-weight: normal">
                                              Выдано
                                          </span>
                                      </th>
                                      <th scope="col" style="width: 120px; text-align: center" >
                                          <span style="color: #ffffff; font-weight: normal">
                                              К выдаче
                                          </span>
                                      </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for type in types %}
                                        <tr  style="height: 30px; min-height: 30px; max-height: 30px;">
                                          <td  id="tbl_row-{{ type }}" scope="row" style="text-align: center;" >{{ type.type_name }}</td>
                                          <td  id="tbl_well_in_mpz_cont-{{ type }}" style="text-align: center;"  data-toggle="modal" data-target="#modalEditMpz" class="mpz_button" onclick="getWellName({{ type }})" >
                                              <span style="z-index: 1" id="tbl_well_in_mpz-{{ type }}">-</span>
                                          </td>
                                          <td  id="tbl_well_given-{{ type }}" style="text-align: center" >-</td>
                                          <td  id="tbl_well_pathof-{{ type }}" style="text-align: center" >-</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="column" style="width: 650px; min-width: 650px; margin-left: 10px">
                            <h1 id="transfer_tbl_head_text" style="margin-left: 0px; margin-top: 10px; height: 20px" hidden>История выдачи</h1>
                            <h1 id="transfer_not_found" style="margin-left: 0px; margin-top: 10px" hidden>Выдача не производилась</h1>
                            <div class="scroll_y" style="height: 634px; overflow-x: scroll; width: 1002px">
                                <table id="transfer_tbl" class=" table table-bordered"  style="margin-bottom: 0px; height: 617px; margin-left: -6px">
                                    <thead class="">
                                        <tr id="transfer_tbl_thead" style="height: 30px; max-height: 30px; background-color: #577fae;">
                                        </tr>
                                    </thead>
                                    <tbody id="transfer_tbl_body">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {#===============MODAL ADD NEW PG===============#}
        <form method="GET">
            <div class="modal fade" id="modalNewPg" tabindex="-1" role="dialog" aria-labelledby="modalNewPg" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Новая проектная группа</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div class="content-box" style="text-align:right; background-color: #ffffff;">
                        <div class="row">
                            <div class="col-sm-4" style="padding-left: 10px;">
                            <td>Имя пр. группы:</td>
                            </div>
                            <div  class="col-sm-4" style="text-align: left">
                                <input  id="newPgName" style="height: 23px;">
                            </div>
                        </div>
                      </div>
                  </div>
                  <div class="modal-footer">
                    <button id="modalNewPgCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                    <button id="modalNewPgSave" type="button" class="btn btn-primary" onclick="">Создать</button>
                  </div>
                </div>
              </div>
            </div>
        </form>
        {#==============================================#}
        {#===============MODAL ADD NEW CODE=============#}
        <form method="GET">
            <div class="modal fade" id="modalNewCode" tabindex="-1" role="dialog" aria-labelledby="modalNewCode" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="newCodeModalTitle">Новый шифр</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div id="newCodeConnect" hidden></div>
                    <div class="content-box" style="text-align:right; background-color: #ffffff;">
                        <div class="row">
                            <div class="col-sm-4" style="padding-left: 10px;">
                            <td>Номер:</td>
                            </div>
                            <div  class="col-sm-4" style="text-align: left">
                                <input  id="newCodeNum" style="height: 23px;">
                            </div>
                        </div>
                      </div>
                  </div>
                  <div class="modal-footer">
                    <button id="modalNewCodeCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                    <button id="modalNewCodeSave" type="button" class="btn btn-primary" onclick="">Добавить</button>
                  </div>
                </div>
              </div>
            </div>
        </form>
        {#==============================================#}
        {#===============MODAL ADD NEW MPZ==============#}
        <form method="GET">
                        <div class="modal fade" id="modalNewMpz" tabindex="-1" role="dialog" aria-labelledby="modalNewMpz" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">Новая заявка МПЗ</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                              <div class="modal-body">
                                <div id="newMpzConnect" hidden></div>
                                <div class="content-box" style="text-align:right; background-color: #ffffff;">
                                    <div class="row">
                                        <div class="col-sm-4" style="padding-left: 10px;">
                                        <td>Номер заявки:</td>
                                        </div>
                                        <div  class="col-sm-4" style="text-align: left">
                                            <input  id="newMpz" style="height: 23px;">
                                        </div>
                                    </div>
                                  </div>
                              </div>
                              <div class="modal-footer">
                                <button id="modalNewMpzCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                                <button id="modalNewMpzSave" type="button" class="btn btn-primary" onclick="">Добавить</button>
                              </div>
                            </div>
                          </div>
                        </div>
</form>
        {#==============================================#}
        {#===============MODAL EDIT MPZ WELL============#}
        <form method="GET">
                        <div class="modal fade" id="modalEditMpz" tabindex="-1" role="dialog" aria-labelledby="modalEditMpz" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">Редактирование заявки</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                              <div class="modal-body">
                                <div id="MpzNumConnect" hidden></div>
                                <div id="WellTypeConnect" hidden></div>
                                <div class="content-box" style="text-align:right; background-color: #ffffff;">
                                    <div class="row">
                                        <div class="col-sm-4" style="padding-left: 10px;">
                                        <td>Количество:</td>
                                        </div>
                                        <div  class="col-sm-4" style="text-align: left">
                                            <select id="modal_well_num" class="form-select" aria-label="Default select example">


                                            </select>
                                        </div>
                                    </div>
                                  </div>
                              </div>
                              <div class="modal-footer">
                                <button id="modalEditWellCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                                <button id="modalEditWellSave" type="button" class="btn btn-primary" onclick="">Добавить</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </form>
        {#==============================================#}
        {#===============MODAL ADD NEW BY===============#}
        <form method="GET">
                    <div class="modal fade" id="modalNewBy" tabindex="-1" role="dialog" aria-labelledby="modalNewBy" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">Новый заказчик</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            <div class="content-box" style="text-align:right; background-color: #ffffff;">
                                <div class="row">
                                    <div class="col-sm-4" style="padding-left: 10px;">
                                    <td>Имя покупателя:</td>
                                    </div>
                                    <div  class="col-sm-4" style="text-align: left">
                                        <input  id="newByName" style="height: 23px;">
                                    </div>
                                </div>
                              </div>
                          </div>
                          <div class="modal-footer">
                            <button id="modalNewByCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                            <button id="modalNewBySave" type="button" class="btn btn-primary" onclick="">Создать</button>
                          </div>
                        </div>
                      </div>
                    </div>
                </form>
        {#==============================================#}
        {#============MODAL ADD NEW BY APPL=============#}
        <form method="GET">
                        <div class="modal fade" id="modalNewByAppl" tabindex="-1" role="dialog" aria-labelledby="modalNewByAppl" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">Новая заявка</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                              <div class="modal-body">
                                <div id="newApplByConnect" hidden></div>
                                <div class="content-box" style="text-align:right; background-color: #ffffff;">
                                    <div class="row">
                                        <div class="col-sm-6" style="padding-left: 10px;">
                                        <td>Номер заявки:</td>
                                        </div>
                                        <div  class="col-sm-4" style="text-align: left">
                                            <input  data-date-format="dd/mm/yyyy" id="appl_by_date" style="height: 23px; width: 95px; margin-left: -22px; padding-left: 5px; margin-top: 2px">
                                        </div>
                                    </div>
                                  </div>
                              </div>
                              <div class="modal-footer">
                                <button id="modalNewApplByCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                                <button id="modalNewApplBySave" type="button" class="btn btn-primary" onclick="">Добавить</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </form>
        {#==============================================#}
        {#=================MODAL DELL PG================#}
        <form method="GET">
                        <div class="modal fade" id="modalDellPg" tabindex="-1" role="dialog" aria-labelledby="modalDellPg" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div id="connect_del_pg" hidden></div>
                              <div class="modal-body" style="text-align: center">
                                Вы уверены что хотите удалить проектную группу?
                              </div>
                              <div class="modal-footer">
                                <button id="modalDellPgCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                                <button id="modalDellPgSave" type="button" class="btn btn-primary" onclick="del_pg()">Удалить</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </form>
        {#==============================================#}
        {#=================MODAL DELL CODE==============#}
        <form method="GET">
                        <div class="modal fade" id="modalDellCode" tabindex="-1" role="dialog" aria-labelledby="modalDellCode" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div id="connect_del_code" hidden></div>
                              <div class="modal-body" style="text-align: center">
                                Вы уверены что хотите удалить шифр?
                              </div>
                              <div class="modal-footer">
                                <button id="modalDellCodeCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                                <button id="modalDellCodeSave" type="button" class="btn btn-primary" onclick="del_code()">Удалить</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </form>
        {#==============================================#}
        {#=================MODAL DELL MPZ===============#}
        <form method="GET">
                        <div class="modal fade" id="modalDellMpz" tabindex="-1" role="dialog" aria-labelledby="modalDellMpz" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div id="connect_del_mpz" hidden></div>
                              <div class="modal-body" style="text-align: center">
                                Вы уверены что хотите удалить заявку?
                              </div>
                              <div class="modal-footer">
                                <button id="modalDellMpzCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                                <button id="modalDellMpzSave" type="button" class="btn btn-primary" onclick="del_mpz()">Удалить</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </form>
        {#==============================================#}
        {#=================MODAL DELL BY================#}
        <form method="GET">
                        <div class="modal fade" id="modalDellBy" tabindex="-1" role="dialog" aria-labelledby="modalDellBy" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div id="connect_del_by" hidden></div>
                                <div id="connect_del_by_ind" hidden></div>
                              <div class="modal-body" style="text-align: center">
                                Вы уверены что хотите удалить покупателя?
                              </div>
                              <div class="modal-footer">
                                <button id="modalDellByCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                                <button id="modalDellBySave" type="button" class="btn btn-primary" onclick="del_by()">Удалить</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </form>
        {#==============================================#}
        {#===============MODAL DELL BYAPPL==============#}
        <form method="GET">
                        <div class="modal fade" id="modalDellByAppl" tabindex="-1" role="dialog" aria-labelledby="modalDellByAppl" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div id="connect_del_byappl" hidden></div>
                                <div id="connect_del_byappl_ind" hidden></div>
                              <div class="modal-body" style="text-align: center">
                                Вы уверены что хотите удалить покупателя?
                              </div>
                              <div class="modal-footer">
                                <button id="modalDellByApplCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Отмена</button>
                                <button id="modalDellByApplSave" type="button" class="btn btn-primary" onclick="delAby()">Удалить</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </form>
        {#==============================================#}
        {#===============MODAL NOT LOGINED==============#}
        <form method="GET">
                        <div class="modal fade" id="modalNotLogined" tabindex="-1" role="dialog" aria-labelledby="modalNotLogined" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div id="connect_del_byappl" hidden></div>
                                <div id="connect_del_byappl_ind" hidden></div>
                              <div class="modal-body">
                                Вход в систему не выполнен!
                              </div>
                              <div class="modal-footer" style="text-align: center;">
                                <button id="modalBtnLogin" type="button" class="btn btn-primary" style="" onclick="goLogin()">Авторизация</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </form>
        {#==============================================#}
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script type="text/javascript" src="/static/js/jquery.treegrid.js"></script>
        <script src="/static/js/wow.min.js"></script>
        <script type="text/javascript">
            let islogined = window.sessionStorage.getItem('islocallogined')
            if ((islogined == null)) {
                $('#modalNotLogined').modal({backdrop: 'static', keyboard: false, style: ''})
                $('#modalNotLogined').modal('show')
            }
            else {
                sessionStorage.setItem('state', 'true')
            }
            $('#tbl_row').height(10);
            $(document).ready(function() {
                var tree_container = document.getElementById("table_struct");
                var tree_pg_content = tree_container.innerHTML;
                var tree = document.getElementById("table_struct");
                var mpz_def_container = document.getElementById("mpz_tbl")
                var mpz_def_content = mpz_def_container.innerHTML
                var tree_state = true

                $('.tree').treegrid();
                $('.tree').treegrid('collapseAll');
                $('#appl_by_date').datepicker({
                        weekStart: 1,
                        daysOfWeekHighlighted: "6,0",
                        autoclose: true,
                        todayHighlight: true,
                    });
                $('#appl_by_date').datepicker("setDate", new Date());
                $('#appl_by_date').datepicker({
                    weekStart: 1,
                    daysOfWeekHighlighted: "6,0",
                    autoclose: true,
                    todayHighlight: true,
                });
                $('#appl_by_date').datepicker("setDate", new Date());
                $("#modalNewPgSave").click(function(s) {
                        $.ajax({
                            type: "GET",
                            url: "/structure/",
                            dataType: "json",
                            data: {
                            event: 'new_pg',
                                new_pg: $('#newPgName').val()
                            },
                            success: function(resp) {
                                if (resp.result == 'success') {
                                    document.getElementById('modalNewPgCancel').click(),
                                    $("#table_struct").load("/ #table_struct > *"),
                                    window.location.reload();
                                }
                                else {
                                    alert('Такая проектная группа уже есть в списке!')
                                }
                            },
                            error: function(result) {
                                var readyState = {
                                1: "Loading",
                                2: "Loaded",
                                3: "Interactive",
                                4: "Complete"
                                };
                                if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                    alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                                }
                            },
                        });

                    });
                $("#modalNewCodeSave").click(function(s) {
                        $.ajax({
                            type: "GET",
                            url: "/structure/",
                            dataType: "json",
                            data: {
                            event: 'new_code',
                                new_code: $('#newCodeNum').val(),
                                connect: $('#newCodeConnect').val()
                            },
                            success: function(resp) {
                                if (resp.result == 'success') {
                                   document.getElementById('modalNewCodeCancel').click(),
                                    $("#table_struct").load("/ #table_struct > *"),
                                    window.location.reload();
                                }
                                else {
                                    alert('такой шифр уже существует!')
                                }
                            },
                            error: function(result) {
                                var readyState = {
                                1: "Loading",
                                2: "Loaded",
                                3: "Interactive",
                                4: "Complete"
                                };
                                if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                    alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                                }
                            },
                        });

                    });
                $("#modalNewMpzSave").click(function(s) {
                        $.ajax({
                            type: "GET",
                            url: "/structure/",
                            dataType: "json",
                            data: {
                            event: 'new_mpz',
                                new_mpz: $('#newMpz').val(),
                                connect: $('#newMpzConnect').val()
                            },
                            success: function(resp) {
                                console.log(resp)
                                if (resp.result == 'success') {
                                   document.getElementById('modalNewMpzCancel').click(),
                                    $("#table_struct").load("/ #table_struct > *"),
                                    window.location.reload();
                                }
                                else {
                                    alert('Такая заявка уже существует!')
                                }
                            },
                            error: function(result) {
                                var readyState = {
                                1: "Loading",
                                2: "Loaded",
                                3: "Interactive",
                                4: "Complete"
                                };
                                if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                    alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                                }
                            },
                        });

                    });
                $("#modalEditWellSave").click(function(s) {
                        if (tree_state == true) {
                            event_type = 'edit_mpz_well'
                            cur_node_name = $('#MpzNumConnect').val()
                            cur_par_name = NaN
                            btn_name = 'infoMPZ-'+$('#MpzNumConnect').val()
                        }
                        else {
                            event_type = 'edit_byapp_well'
                            cur_node_name = (((document.getElementById($('#MpzNumConnect').val()).textContent).split('\n'))[1].split('#'))[1]
                            cur_par_name = ((document.getElementById('node-'+($('#MpzNumConnect').val().split('-'))[1]).textContent).split('\n')) [1]
                            btn_name = 'infoABY-'+$('#MpzNumConnect').val()
                        }
                        $.ajax({
                            type: "GET",
                            url: "/structure/",
                            dataType: "json",
                            data: {
                            event: event_type,
                                mpz_name: cur_node_name,
                                type_id: $('#WellTypeConnect').val(),
                                new_value: $('#modal_well_num').val(),
                                par_name: cur_par_name
                            },
                            success: function(resp) {

                                document.getElementById('modalEditWellCancel').click(),
                                document.getElementById(btn_name).click()
                            },
                            error: function(result) {
                                var readyState = {
                                1: "Loading",
                                2: "Loaded",
                                3: "Interactive",
                                4: "Complete"
                                };
                                if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                    alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                                }
                            },
                        });

                    });
                $("#cb_tree").change(function(s) {
                        document.getElementById("table_struct").innerHTML = ""

                        if ($("#cb_tree").val() == "os") {
                            tree_state = false
                            document.getElementById("addPG").hidden = true
                            document.getElementById("addBY").hidden = false
                            $.ajax({
                                type: "GET",
                                url: "/structure/",
                                dataType: "json",
                                data: {
                                event: 'get_by_data'
                                },
                                success: function(resp) {
                                    var i = 0
                                    for (const [key, value] of Object.entries(resp)) {

                                        $('#table_struct').append('<tr id="node-'+i+'" class="custom_hov treegrid-'+i+' treegrid-collapsed" style="height: 30px;">\n' +
                                                                    '<td id="node_name-'+i+'"style="width: 240px; padding-left:25px">'+value[0]+'</td>\n' +
                                                                    '<td style="text-align: right">\n' +
                                                                    '<button id="addBYApp" name="node-'+i+'" value="val_6" type="button" class="btn btn-light btn-sm" data-toggle="modal" data-target="#modalNewByAppl" style="height: 20px; width: 20px; margin-left: 19px; margin-right: 19px; background-color: #e3e7ef; border: none" onclick="takeNodeChName(name)">\n' +
                                                                    '<h5 style="margin-top: -8px; margin-left: -5px; color: #4f565c; font-weight: normal">+</h5>\n' +
                                                                    '</button>\n' +
                                                                    '</td>\n' +
                                                                    '<td style="text-align: right">\n' +
                                                                    '<button id="delBY-'+i+'" name="'+i+'" value="val_6" type="button" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: -15px; margin-right: 10px; background-color: #e3e7ef; border: none" data-toggle="modal" data-target="#modalDellBy" onclick="del_by_get_modal(name)">\n' +
                                                                    '<h5 style="margin-top: -8px; margin-left: -2px; color: #4f565c; font-weight: normal">-</h5>\n' +
                                                                    '</button>\n' +
                                                                    '</td>\n' +
                                                                    '</tr>');
                                        var appl_lst = value[1]
                                        var j = 0
                                        for (;;) {
                                            if (j == appl_lst.length) {
                                                break
                                            }
                                            else {
                                                $('#table_struct').append('<tr id="node-'+i+'-'+j+'" class="custom_hov treegrid-parent-'+i+'" style="height: 30px;">\n' +
                                                                            '<td style="width: 100px; padding-left: 30px;">#'+appl_lst[j]+'</td>\n' +
                                                                            '<td style="text-align: right">\n' +
                                                                            '<button id="infoABY-node-'+i+'-'+j+'" name="node-'+i+'-'+j+'" value="" type="button" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: 19px; margin-right: 19px; background-color: #e3e7ef; border: none" onclick="get_by_app_data(name)">\n' +
                                                                            '<h5 style="margin-top: -7px; margin-left: -1px; color: #112945; font-weight: normal">i</h5>\n' +
                                                                            '</button>\n' +
                                                                            '</td>\n' +
                                                                            '<td style="text-align: right">\n' +
                                                                            '<button id="dellABY-'+j+'" name="node-'+i+'-'+j+'" value="val_6" type="button" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: -15px; margin-right: 10px; background-color: #e3e7ef; border: none" data-toggle="modal" data-target="#modalDellByAppl" onclick="del_byappl_get_modal(name)">\n' +
                                                                            '<h5 style="margin-top: -8px; margin-left: -2px; color: #4f565c; font-weight: normal">-</h5>\n' +
                                                                            '</button>\n' +
                                                                            '</td>\n' +
                                                                            '</tr>');
                                                j++
                                            }
                                        }
                                        document.getElementById('node-'+i).name = j
                                        i++
                                    }
                                    $("#table_struct").treegrid()
                                    $('#table_struct').treegrid('collapseAll');
                                },
                                error: function(result) {
                                    var readyState = {
                                    1: "Loading",
                                    2: "Loaded",
                                    3: "Interactive",
                                    4: "Complete"
                                    };
                                    if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                        alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                                    }
                                },
                            });
                            document.getElementById("mpz_tbl").innerHTML = mpz_def_content
                        }
                        else {
                            tree_state = true
                            document.getElementById("table_struct").innerHTML= tree_pg_content;
                            $("#table_struct").treegrid()
                            $('#table_struct').treegrid('collapseAll')
                            document.getElementById("mpz_tbl").innerHTML = mpz_def_content
                            document.getElementById("addBY").hidden = true
                            document.getElementById("addPG").hidden = false
                        }

                    });
                $("#modalNewBySave").click(function(s) {
                        $.ajax({
                            type: "GET",
                            url: "/structure/",
                            dataType: "json",
                            data: {
                            event: 'new_by',
                                new_by: $('#newByName').val()
                            },
                            success: function(resp) {
                                console.log(resp.unique)
                                if (resp.unique == 'false') {
                                    var cur_ind = (parseInt(resp.by_par_len, 10));
                                    document.getElementById('modalNewByCancel').click(),

                                    $('#table_struct').append('<tr id="node-'+cur_ind+'" class="custom_hov treegrid-'+cur_ind+'" style="height: 30px;">\n' +
                                                                    '<td id="node_name-'+cur_ind+'" style="width: 240px;padding-left:25px">'+$('#newByName').val()+'</td>\n' +
                                                                    '<td style="text-align: right">\n' +
                                                                    '<button id="addBYApp" name="node-'+cur_ind+'" value="val_6" type="button" class="btn btn-light btn-sm" data-toggle="modal" data-target="#modalNewByAppl" style="height: 20px; width: 20px; margin-left: 19px; margin-right: 19px; background-color: #e3e7ef; border: none" onclick="takeNodeChName(name)">\n' +
                                                                    '<h5 style="margin-top: -8px; margin-left: -5px; color: #4f565c; font-weight: normal">+</h5>\n' +
                                                                    '</button>\n' +
                                                                    '</td>\n' +
                                                                    '<td style="text-align: right">\n' +
                                                                    '<button id="delBY-'+cur_ind+'" name="'+cur_ind+'" value="val_6" type="button" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: -15px; margin-right: 10px; background-color: #e3e7ef; border: none" data-toggle="modal" data-target="#modalDellBy" onclick="del_by_get_modal(name)">\n' +
                                                                    '<h5 style="margin-top: -8px; margin-left: -2px; color: #4f565c; font-weight: normal">-</h5>\n' +
                                                                    '</button>\n' +
                                                                    '</td>\n' +
                                                                    '</tr>'),
                                    document.getElementById('node-'+cur_ind).name = 0,
                                    $('.tree').treegrid(),
                                    $('#table_struct').treegrid('collapseAll');
                                }
                                else {alert('Такой покупатель уже есть в списке!')}

                            },
                            error: function(result) {
                                var readyState = {
                                1: "Loading",
                                2: "Loaded",
                                3: "Interactive",
                                4: "Complete"
                                };
                                if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                    alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                                }
                            },
                        });
                    });
                $("#modalNewApplBySave").click(function(s) {
                        app_name = $('#appl_by_date').val()
                        p_app_name = app_name.split('/')
                        cur_app_name = p_app_name[0]+'.'+p_app_name[1]+'.'+(parseInt(p_app_name[2],10)-2000)
                        par_name_str = document.getElementById(document.getElementById('newApplByConnect').textContent).textContent
                        par_name = par_name_str.split('\n')
                        $.ajax({
                            type: "GET",
                            url: "/structure/",
                            dataType: "json",
                            data: {
                            event: 'new_app_by',
                                new_app_by: cur_app_name,
                                app_par_name: par_name[1]
                            },
                            success: function(resp) {
                                console.log(resp)
                                if (resp.result == 'success') {

                                par_node_name = document.getElementById('newApplByConnect').value
                                console.log('par node name: '+par_node_name)
                                console.log(par_node_name)
                                par_node_len = parseInt(document.getElementById(par_node_name).name,10) -1
                                console.log('par node len before add record: '+par_node_len)
                                next_ch_ind = par_node_len + 1
                                next_ch_id = par_node_name+'-'+next_ch_ind
                                let p_par_name = par_node_name.split('-')
                                let par_ind = parseInt(p_par_name[1],10)
                                document.getElementById('modalNewApplByCancel').click()
                               $('#'+par_node_name).after('<tr id="'+next_ch_id+'" class="custom_hov treegrid-parent-'+par_ind+'" style="height: 30px;">\n' +
                                '<td style="width: 100px;padding-left: 30px;">#'+cur_app_name+'</td>\n' +
                                '<td style="text-align: right">\n' +
                                '<button id="infoABY-'+next_ch_id+'" name="'+next_ch_id+'" value="" type="button" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: 19px; margin-right: 19px; background-color: #e3e7ef; border: none" onclick="get_by_app_data(name)">\n' +
                                '<h5 style="margin-top: -7px; margin-left: -1px; color: #112945; font-weight: normal">i</h5>\n' +
                                '</button>\n' +
                                '</td>\n' +
                                '<td style="text-align: right">\n' +
                                '<button id="dellABY-'+next_ch_id+'" name="'+next_ch_id+'" value="val_6" type="button" class="btn btn-light btn-sm" style="height: 20px; width: 20px; margin-left: -15px; margin-right: 10px; background-color: #e3e7ef; border: none" data-target="#modalDellByAppl" onclick="del_byappl_get_modal(name)">\n' +
                                '<h5 style="margin-top: -8px; margin-left: -2px; color: #4f565c; font-weight: normal">-</h5>\n' +
                                '</button>\n' +
                                '</td>\n' +
                                '</tr>');
                                document.getElementById(par_node_name).name = parseInt(document.getElementById(par_node_name).name,10) + 1
                                    console.log('par node len after add record: '+document.getElementById(par_node_name).name)
                                $('.tree').treegrid('')
                                }
                                if (resp.result == 'denied') {
                                    console.log('DENIED!!!')
                                    alert('такое имя заявки уже существует!')
                                }

                            },
                            error: function(result) {
                                var readyState = {
                                1: "Loading",
                                2: "Loaded",
                                3: "Interactive",
                                4: "Complete"
                                };
                                if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                                    alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                                }
                            },
                        });
                        console.log('new buy appl creating done!')
                    });
                $("#modal_well_num").change(function(s) {
                        {#console.log($("#modal_well_num").val())#}

                    });
            });
            function del_pg(name) {
                $.ajax({
                    type: "GET",
                    url: "/structure/",
                    dataType: "json",
                    data: {
                    event: 'del_pg',
                        del_pg: document.getElementById("connect_del_pg").textContent
                    },
                    success: function(resp) {
                        $("#table_struct").load("/ #table_struct > *");
                        window.location.reload()
                    },
                    error: function(result) {
                        var readyState = {
                        1: "Loading",
                        2: "Loaded",
                        3: "Interactive",
                        4: "Complete"
                        };
                        if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                            alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                        }
                    },
                });

            }
            function del_by() {

                $.ajax({
                    type: "GET",
                    url: "/structure/",
                    dataType: "json",
                    data: {
                    event: 'del_by',
                        del_by: document.getElementById('connect_del_by').textContent
                    },
                    success: function(resp) {
                        document.getElementById('modalDellByCancel').click()
                        $('#node-'+document.getElementById('connect_del_by_ind').textContent).remove(),
                        $('.tree').treegrid('collapseAll')
                        $("#cb_tree").val('os').trigger('change');

                    },
                    error: function(result) {
                        var readyState = {
                        1: "Loading",
                        2: "Loaded",
                        3: "Interactive",
                        4: "Complete"
                        };
                        if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                            alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                        }
                    },
                });
            }
            function del_code(name) {
                $.ajax({
                    type: "GET",
                    url: "/structure/",
                    dataType: "json",
                    data: {
                    event: 'del_code',
                        del_code: document.getElementById("connect_del_code").textContent
                    },
                    success: function(resp) {
                        $("#table_struct").load("/ #table_struct > *");
                        window.location.reload()
                    },
                    error: function(result) {
                        var readyState = {
                        1: "Loading",
                        2: "Loaded",
                        3: "Interactive",
                        4: "Complete"
                        };
                        if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                            alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                        }
                    },
                });

            }
            function del_mpz(name) {
                $.ajax({
                    type: "GET",
                    url: "/structure/",
                    dataType: "json",
                    data: {
                    event: 'del_mpz',
                        del_mpz: document.getElementById("connect_del_mpz").textContent
                    },
                    success: function(resp) {
                        $("#table_struct").load("/ #table_struct > *");
                        window.location.reload()
                    },
                    error: function(result) {
                        var readyState = {
                        1: "Loading",
                        2: "Loaded",
                        3: "Interactive",
                        4: "Complete"
                        };
                        if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                            alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                        }
                    },
                });

            }
            function takePgName(name) {
                htmlData = name
                $('#newCodeConnect').html(htmlData)
                $('#newCodeConnect').val(htmlData)

            }
            function takeNodeChName(name) {
                htmlData = name
                $('#newApplByConnect').html(htmlData)
                $('#newApplByConnect').val(htmlData)

        }
            function takeCodeName(name) {
                console.log('MPZnAME: '+name)
                htmlData = name
                $('#newMpzConnect').html(htmlData)
                $('#newMpzConnect').val(htmlData)
                console.log('done')

            }
            function get_mpz_data(name) {
                $('.tree').treegrid('getAllNodes').each(function() {
                        this.style.backgroundColor = defaultStatus;
                        this.classList.add("custom_hov");
                }),
                document.getElementById(name).style.backgroundColor = '#95b1d0',
                $.ajax({
                    type: "GET",
                    url: "/structure/",
                    dataType: "json",
                    data: {
                    event: 'get_mpz',
                        mpz_num: name
                    },

                success: function(resp) {
                        document.getElementById("GlobalMpzNumConnect").innerHTML = name;
                        document.getElementById("MpzNumConnect").innerHTML = name;
                        document.getElementById("MpzNumConnect").value = name;
                        let mpz_name = ((document.getElementById("mpz_name-"+name).textContent).split('№'))[1]
                        document.getElementById("mpz_tbl_head_text").innerHTML = 'Заявка # '+mpz_name

                        for (const [key, value] of Object.entries(resp)) {
                            if (value[1] == "0") {
                                console.log('0')
                                color_mpz = '#aeaeae'
                                text_weight_mpz = 'normal'
                            }
                            else {
                                color_mpz = '#000000'
                                text_weight_mpz = 'bold'
                            }
                            if (value[2] == "0") {
                                console.log('0')
                                color_given = '#aeaeae'
                                text_weight_given = 'normal'
                            }
                            else {
                                color_given = '#000000'
                                text_weight_given = 'bold'
                            }
                            if (value[3] == "0") {
                                color_pathof = '#aeaeae'
                                text_weight_pathof = 'normal'
                                back_pathof = '#ffffff'
                            }
                            else {
                                if (parseInt(value[3],10) < 0) {
                                    color_pathof = '#000000'
                                    text_weight_pathof = 'bold'
                                    back_pathof = '#d3362b'
                                }
                                else {
                                    color_pathof = '#000000'
                                    text_weight_pathof = 'bold'
                                    back_pathof = '#ffffff'
                                }
                            }
                            document.getElementById('tbl_well_in_mpz-' + value[0]).innerHTML = value[1];
                            document.getElementById('tbl_well_in_mpz-' + value[0]).style.color = color_mpz;
                            document.getElementById('tbl_well_in_mpz-' + value[0]).style.fontWeight = text_weight_mpz;
                            document.getElementById('tbl_well_given-' + value[0]).innerHTML = value[2];
                            document.getElementById('tbl_well_given-' + value[0]).style.color = color_given;
                            document.getElementById('tbl_well_given-' + value[0]).style.fontWeight = text_weight_given;
                            document.getElementById('tbl_well_pathof-' + value[0]).innerHTML = value[3];
                            document.getElementById('tbl_well_pathof-' + value[0]).style.color = color_pathof;
                            document.getElementById('tbl_well_pathof-' + value[0]).style.fontWeight = text_weight_pathof;
                            document.getElementById('tbl_well_pathof-' + value[0]).style.backgroundColor = back_pathof;
                        }
                        get_mpz_transfer_data(name)
                    },
                    error: function(result) {
                        var readyState = {
                        1: "Loading",
                        2: "Loaded",
                        3: "Interactive",
                        4: "Complete"
                        };
                        if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                            alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                        }
                    },
                });
            }
            function get_mpz_transfer_data(name) {
                $.ajax({
                    type: "GET",
                    url: "/structure/",
                    dataType: "json",
                    data: {
                    event: 'get_transfer_data_mpz',
                        mpz_num: name
                    },

                    success: function(resp) {
                        document.getElementById('transfer_not_found').hidden = true
                        document.getElementById('transfer_tbl').hidden = true
                        document.getElementById('transfer_tbl_thead').innerHTML = ''
                        document.getElementById('transfer_tbl_body').innerHTML = ''
                        document.getElementById('mpz_tbl_head_text_first').hidden = true
                        document.getElementById('mpz_tbl_head_text').hidden = false
                        document.getElementById('transfer_tbl_head_text').hidden = false
                        document.getElementById('mpz_tbl').hidden = false
                        date_lst = resp[0]
                        data_lst = resp[1]
                        console.log(data_lst)
                        if (date_lst == 0) {
                            document.getElementById('transfer_not_found').hidden = false
                        }
                        else {
                            document.getElementById('transfer_tbl').hidden = false
                        }
                        i = 0
                        for (;;) {
                           if (i == date_lst.length) { break}
                           else {
                               $('#transfer_tbl_thead').append('<th scope="col" style="width: 100px; max-width: 100px; min-width: 100px; text-align: center;"><h1 id="GlobalMpzNumConnect" hidden></h1>\n' +
                                '<span style="color: #ffffff; font-weight: normal">\n' +
                                ''+date_lst[i]+'\n' +
                                '</span>\n' +
                                '</th>')
                               i++
                           }
                        }
                        i = 0
                        for (;;) {
                            if (i == data_lst.length) {break}
                            else {
                                j = 0
                                p_data_lst = data_lst[i]
                                $('#transfer_tbl_body').append('<tr id="tbl_trans_row-'+i+'"height: 30px; min-height: 30px; max-height: 30px;">\n' +
                                                                '</tr>')
                                for (;;) {
                                    if (j == p_data_lst.length) {break}
                                    else {
                                        if (p_data_lst[j] == "0") {
                                            console.log('0')
                                            color_mpz = '#aeaeae'
                                            text_weight_mpz = 'normal'
                                        }
                                        else {
                                            color_mpz = '#000000'
                                            text_weight_mpz = 'bold'
                                        }
                                        $('#tbl_trans_row-'+i).append('<td  id="tbl_row-'+i+j+'" scope="row" style="color: '+color_mpz+'; text-align: center; border: 1px solid #a4abb3" >'+p_data_lst[j]+'</td>')
                                        j++
                                    }
                                }
                                i++
                            }
                        }
                    },
                    error: function(result) {
                        var readyState = {
                        1: "Loading",
                        2: "Loaded",
                        3: "Interactive",
                        4: "Complete"
                        };
                        if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                            alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                        }
                    },
                });
            }
            function getWellName(name) {
                var w_val = document.getElementById("tbl_well_in_mpz-" + name).value
                document.getElementById("modal_well_num").innerHTML = "";
                $('#modal_well_num').append('<option id="modal_select_well_num" selected ></option>');

                for (const x of Array(101).keys()) {
                    if (x != w_val) {
                        $('#modal_well_num').append('<option  value="'+x+'">'+x+'</option>');
                    }
                }
                document.getElementById("WellTypeConnect").innerHTML = name
                document.getElementById("WellTypeConnect").value = name
                document.getElementById("modal_select_well_num").innerHTML = w_val
                document.getElementById("modal_select_well_num").value = w_val
            }
            function delAby() {
                ch_name = ''
                par_name = ''
                ch_name = ((((document.getElementById(document.getElementById('connect_del_byappl').textContent).textContent).split('\n'))[1]).split('#'))[1]
                par_name = ((document.getElementById('node-'+((document.getElementById('connect_del_byappl').textContent).split('-'))[1]).textContent).split('\n'))[1]

                $.ajax({
                type: "GET",
                url: "/structure/",
                dataType: "json",

                data: {
                event: 'del_app_by',
                    node_name: ch_name,
                    pr_name: par_name

                },
                success: function(resp) {
                    document.getElementById('modalDellByApplCancel').click(),
                    $('#'+document.getElementById('connect_del_byappl').textContent).remove(),
                    $('.tree').treegrid('')
                },
                error: function(result) {
                    var readyState = {
                    1: "Loading",
                    2: "Loaded",
                    3: "Interactive",
                    4: "Complete"
                    };
                    if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                        alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                    }
                },
            });
            }
            function get_by_app_data(name) {
                node_name = (((document.getElementById(name).textContent).split('\n'))[1].split('#'))[1]
                console.log(node_name)
                par_name = ((document.getElementById('node-'+(name.split('-'))[1]).textContent).split('\n')) [1]
                console.log(par_name)
                $('.tree').treegrid('getAllNodes').each(function() {
                        this.style.backgroundColor = defaultStatus;
                        this.classList.add("custom_hov");
                }),
                document.getElementById(name).style.backgroundColor = '#95b1d0',
                $.ajax({
                    type: "GET",
                    url: "/structure/",
                    dataType: "json",
                    data: {
                    event: 'get_app_by_data',
                        app_name: node_name,
                        par_name: par_name
                    },

                success: function(resp) {
                        document.getElementById("GlobalMpzNumConnect").innerHTML = name;
                        document.getElementById("MpzNumConnect").innerHTML = name;
                        document.getElementById("MpzNumConnect").value = name;
                        document.getElementById("mpz_tbl_head_text").innerHTML = 'Заявка # '+node_name+' ('+par_name+')'
                        for (const [key, value] of Object.entries(resp)) {
                            if (value[1] == "0") {
                                console.log('0')
                                color_mpz = '#aeaeae'
                                text_weight_mpz = 'normal'
                            }
                            else {
                                color_mpz = '#000000'
                                text_weight_mpz = 'bold'
                            }
                            if (value[2] == "0") {
                                console.log('0')
                                color_given = '#aeaeae'
                                text_weight_given = 'normal'
                            }
                            else {
                                color_given = '#000000'
                                text_weight_given = 'bold'
                            }
                            if (value[3] == "0") {
                                color_pathof = '#aeaeae'
                                text_weight_pathof = 'normal'
                                back_pathof = '#ffffff'
                            }
                            else {
                                if (parseInt(value[3], 10) < 0) {
                                    color_pathof = '#000000'
                                    text_weight_pathof = 'bold'
                                    back_pathof = '#d3362b'
                                } else {
                                    color_pathof = '#000000'
                                    text_weight_pathof = 'bold'
                                    back_pathof = '#ffffff'
                                }
                            }
                            document.getElementById('tbl_well_in_mpz-' + value[0]).innerHTML = value[1];
                            document.getElementById('tbl_well_in_mpz-' + value[0]).style.color = color_mpz;
                            document.getElementById('tbl_well_in_mpz-' + value[0]).style.fontWeight = text_weight_mpz;
                            document.getElementById('tbl_well_given-' + value[0]).innerHTML = value[2];
                            document.getElementById('tbl_well_given-' + value[0]).style.color = color_given;
                            document.getElementById('tbl_well_given-' + value[0]).style.fontWeight = text_weight_given;
                            document.getElementById('tbl_well_pathof-' + value[0]).innerHTML = value[3];
                            document.getElementById('tbl_well_pathof-' + value[0]).style.color = color_pathof;
                            document.getElementById('tbl_well_pathof-' + value[0]).style.fontWeight = text_weight_pathof;
                            document.getElementById('tbl_well_pathof-' + value[0]).style.backgroundColor = back_pathof;
                        }
                        get_buy_transfer_data(node_name, par_name)
                    },
                error: function(result) {
                    var readyState = {
                    1: "Loading",
                    2: "Loaded",
                    3: "Interactive",
                    4: "Complete"
                    };
                    if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                        alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                    }
                },
                });
            }
            function get_buy_transfer_data(name) {
                $.ajax({
                    type: "GET",
                    url: "/structure/",
                    dataType: "json",
                    data: {
                    event: 'get_transfer_data_buy',
                        app_name: par_name,
                        par_name: node_name
                    },

                    success: function(resp) {
                        document.getElementById('transfer_not_found').hidden = true
                        document.getElementById('transfer_tbl').hidden = true
                        document.getElementById('transfer_tbl_thead').innerHTML = ''
                        document.getElementById('transfer_tbl_body').innerHTML = ''
                        document.getElementById('mpz_tbl_head_text_first').hidden = true
                        document.getElementById('mpz_tbl_head_text').hidden = false
                        document.getElementById('transfer_tbl_head_text').hidden = false
                        document.getElementById('mpz_tbl').hidden = false
                        date_lst = resp[0]
                        data_lst = resp[1]
                        console.log(data_lst)
                        if (date_lst == 0) {
                            document.getElementById('transfer_not_found').hidden = false
                        }
                        else {
                            document.getElementById('transfer_tbl').hidden = false
                        }
                        i = 0
                        for (;;) {
                           if (i == date_lst.length) { break}
                           else {
                               $('#transfer_tbl_thead').append('<th scope="col" style="width: 100px; max-width: 100px; min-width: 100px; text-align: center;"><h1 id="GlobalMpzNumConnect" hidden></h1>\n' +
                                '<span style="color: #ffffff; font-weight: normal">\n' +
                                ''+date_lst[i]+'\n' +
                                '</span>\n' +
                                '</th>')
                               i++
                           }
                        }
                        i = 0
                        for (;;) {
                            if (i == data_lst.length) {break}
                            else {
                                j = 0
                                p_data_lst = data_lst[i]
                                $('#transfer_tbl_body').append('<tr id="tbl_trans_row-'+i+'"height: 30px; min-height: 30px; max-height: 30px;">\n' +
                                                                '</tr>')
                                for (;;) {
                                    if (j == p_data_lst.length) {break}
                                    else {
                                        if (p_data_lst[j] == "0") {
                                            console.log('0')
                                            color_mpz = '#aeaeae'
                                            text_weight_mpz = 'normal'
                                        }
                                        else {
                                            color_mpz = '#000000'
                                            text_weight_mpz = 'bold'
                                        }
                                        $('#tbl_trans_row-'+i).append('<td  id="tbl_row-'+i+j+'" scope="row" style="color: '+color_mpz+'; text-align: center; border: 1px solid #a4abb3" >'+p_data_lst[j]+'</td>')
                                        j++
                                    }
                                }
                                i++
                            }
                        }
                    },
                    error: function(result) {
                        var readyState = {
                        1: "Loading",
                        2: "Loaded",
                        3: "Interactive",
                        4: "Complete"
                        };
                        if(result.readyState !== 0 && result.status !== 0 && result.responseText !== undefined) {
                            alert("readyState: " + readyState[result.readyState] + "\n status: " + result.status + "\n\n responseText: " + result.responseText);
                        }
                    },
                });
            }
            function del_pg_get_modal(name) {
                document.getElementById("connect_del_pg").innerHTML = name
            }
            function del_code_get_modal(name) {
                console.log(name)
                document.getElementById("connect_del_code").innerHTML = name
            }
            function del_mpz_get_modal(name) {
                console.log(name)
                document.getElementById("connect_del_mpz").innerHTML = name
            }
            function del_by_get_modal(name) {
                document.getElementById("connect_del_by").innerHTML = document.getElementById('node_name-'+name).textContent
                document.getElementById("connect_del_by_ind").innerHTML = name
            }
            function del_byappl_get_modal(name) {
                document.getElementById("connect_del_byappl").innerHTML = name
            }
            function backMain() {
                window.sessionStorage.setItem('islogined', 'true');
                window.location.href = '/'
            }
            function goLogin() {
                window.addEventListener("beforeunload", () => sessionStorage.removeItem('islogined'));
                window.addEventListener("beforeunload", () => sessionStorage.removeItem('islocallogined'));
                window.location.href = '/'
            }
        </script>
    </body>
</html>